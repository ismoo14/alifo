<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MediQuiz Pro | Advanced Medical Education</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style type="text/css">
        /* Import Inter font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

        :root {
            --primary: #3b82f6; 
            --primary-dark: #2563eb; 
            --primary-light: #dbeafe; 
            --secondary: #6b7280; 
            --success: #22c55e; 
            --error: #ef4444; 
            --warning: #eab308; 
            --info: #0ea5e9; 
            --background: #ffffff; 
            --surface: #f9fafb; 
            --text-primary: #111827; 
            --text-secondary: #4b5563; 
            --text-tertiary: #9ca3af; 
            --border: #e5e7eb; 
            --shadow: 0 2px 4px rgba(0, 0, 0, 0.05); 
            --shadow-lg: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 8px 16px rgba(0, 0, 0, 0.05);
            --radius: 8px; 
            --radius-lg: 12px;
            --radius-xl: 16px;
            --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); 
            --gradient: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
            --glass: rgba(255, 255, 255, 0.85); 
            --glass-border: rgba(229, 231, 235, 0.3);
        }

        .dark-mode {
            --primary: #60a5fa;
            --primary-dark: #3b82f6;
            --primary-light: #93c5fd;
            --secondary: #94a3b8;
            --background: #000000; 
            --surface: #111827; 
            --text-primary: #f9fafb; 
            --text-secondary: #d1d5db; 
            --text-tertiary: #6b7280; 
            --border: #1f2937; 
            --shadow: 0 2px 4px rgba(0, 0, 0, 0.6); 
            --shadow-lg: 0 4px 8px rgba(0, 0, 0, 0.6);
            --shadow-xl: 0 8px 16px rgba(0, 0, 0, 0.6);
            --glass: rgba(17, 24, 39, 0.85); 
            --glass-border: rgba(31, 41, 55, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none; 
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 16px;
            transition: var(--transition);
            min-height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        /* App Layout */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--surface);
            border-right: 1px solid var(--border);
            padding: 24px 0;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: var(--shadow);
            transform: translateX(-100%);
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar-header {
            padding: 0 24px 16px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 22px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .logo i {
            font-size: 24px;
        }

        .sidebar-subtitle {
            font-size: 13px;
            color: var(--text-tertiary);
            font-weight: 400;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 24px;
            margin-bottom: 24px;
            background: var(--glass);
            border-radius: var(--radius);
            margin: 0 16px 24px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
            box-shadow: var(--shadow);
        }

        .user-info h3 {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .user-info p {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: var(--glass);
            border-left-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .nav-item.active {
            background: var(--primary-light);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        .nav-item.active .nav-icon {
            color: var(--primary);
        }

        .nav-icon {
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
        }

        .categories-section {
            margin-top: 24px;
        }

        .section-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .categories-grid {
            padding: 0 16px;
        }

        .category-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .category-card:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }

        .category-card.active {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .category-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
        }

        .category-card.active .category-icon {
            background: var(--primary);
        }

        .category-name {
            font-weight: 500;
            font-size: 14px;
        }

        .category-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
        }

        .progress-bar {
            flex: 1;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            overflow: hidden;
            margin-right: 8px;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 2px;
            transition: width 0.4s ease;
        }

        .progress-text {
            font-size: 12px;
            color: var(--text-tertiary);
            font-weight: 500;
        }

        .category-card.active .progress-text {
            color: var(--primary);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 0;
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .main-content.sidebar-open {
            margin-left: 280px;
        }

        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 32px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .menu-toggle {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--text-primary);
            cursor: pointer;
            padding: 8px;
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .menu-toggle:hover {
            background: var(--primary-light);
        }

        .page-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .mode-selector {
            display: flex;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 4px;
        }

        .mode-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .mode-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
            padding: 24px 32px;
        }

        .stat-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .stat-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Quiz Container */
        .quiz-container {
            padding: 0 32px 32px;
        }

        .question-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .question-card.fade-in {
            opacity: 1;
        }

        .question-card:hover {
            box-shadow: var(--shadow-lg);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
        }

        .question-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .question-number {
            font-size: 13px;
            font-weight: 600;
            color: var(--primary);
            background: var(--primary-light);
            padding: 6px 12px;
            border-radius: 16px;
        }

        .question-category {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
            background: var(--glass);
            padding: 6px 12px;
            border-radius: 16px;
        }

        .question-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid var(--border);
            background: var(--glass);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-secondary);
        }

        .action-btn:hover {
            background: var(--primary-light);
            color: var(--primary);
            border-color: var(--primary-light);
        }

        .question-text {
            font-size: 18px;
            font-weight: 500;
            line-height: 1.6;
            margin-bottom: 24px;
            color: var(--text-primary);
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }

        .option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            background: var(--glass);
            min-height: 60px;
        }

        .option:hover {
            border-color: var(--primary-light);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .option.selected {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .option.correct {
            border-color: var(--success);
            background: rgba(34, 197, 94, 0.05);
        }

        .option.incorrect {
            border-color: var(--error);
            background: rgba(239, 68, 68, 0.05);
        }

        .option-letter {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--surface);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-secondary);
            flex-shrink: 0;
            transition: var(--transition);
        }

        .option.selected .option-letter {
            background: var(--primary);
            color: white;
        }

        .option.correct .option-letter {
            background: var(--success);
            color: white;
        }

        .option.incorrect .option-letter {
            background: var(--error);
            color: white;
        }

        .option-text {
            flex: 1;
            font-size: 15px;
            font-weight: 400;
        }

        /* Explanation Section */
        .explanation-section {
            margin-top: 24px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 24px;
        }

        .explanation-section details {
            margin-bottom: 16px;
        }

        .explanation-section summary {
            padding: 12px 16px;
            background: var(--surface);
            cursor: pointer;
            font-weight: 500;
            font-size: 15px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .explanation-section summary:hover {
            background: var(--primary-light);
        }

        .explanation-section details[open] summary {
            background: var(--primary);
            color: white;
        }

        .explanation-content {
            padding: 16px;
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .explanation-content strong {
            color: var(--text-primary);
        }

        .correct-answer, .why-not-section, .related-questions {
            margin-bottom: 16px;
            padding: 16px;
            border-radius: var(--radius);
        }

        .correct-answer {
            background: rgba(34, 197, 94, 0.05);
            border-left: 4px solid var(--success);
        }

        .why-not-section {
            background: rgba(239, 68, 68, 0.05);
            border-left: 4px solid var(--error);
        }

        .related-questions {
            background: rgba(59, 130, 246, 0.05);
            border-left: 4px solid var(--primary);
        }

        .related-questions-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .related-question-tag {
            padding: 6px 12px;
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary);
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .related-question-tag:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: translateY(-1px);
        }

        /* Quiz Controls */
        .quiz-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .quiz-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .quiz-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .quiz-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .check-btn {
            background: var(--primary);
            color: white;
        }

        .check-btn:hover:not(:disabled) {
            background: var(--primary-dark);
        }

        .next-btn {
            background: var(--success);
            color: white;
        }

        .next-btn:hover:not(:disabled) {
            background: #16a34a;
        }

        .submit-btn {
            background: var(--gradient);
            color: white;
            padding: 12px 32px;
            font-size: 16px;
        }

        /* Results Screen */
        .results-screen {
            padding: 32px;
            max-width: 900px;
            margin: 0 auto;
        }

        .results-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 48px;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .results-header {
            margin-bottom: 32px;
        }

        .results-title {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .score-display {
            font-size: 64px;
            font-weight: 700;
            margin: 32px 0;
            color: var(--text-primary);
        }

        .score-text {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 32px;
        }

        .results-details {
            text-align: left;
            margin: 48px 0;
            background: var(--glass);
            border-radius: var(--radius);
            padding: 24px;
            border: 1px solid var(--glass-border);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-question {
            flex: 1;
            font-size: 14px;
        }

        .result-status {
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
        }

        .result-correct {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success);
        }

        .result-incorrect {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        .restart-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 16px 48px;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .restart-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            z-index: 999;
            display: none;
            transition: opacity 0.3s ease;
        }

        .overlay.active {
            display: block;
            opacity: 1;
        }

        /* Enhanced Features */
        .search-container {
            padding: 16px 32px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
        }

        .search-box {
            display: flex;
            align-items: center;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 12px 16px;
            max-width: 400px;
            margin: 0 auto;
        }

        .search-box input {
            flex: 1;
            border: none;
            background: transparent;
            color: var(--text-primary);
            font-size: 14px;
            outline: none;
        }

        .search-box i {
            color: var(--text-tertiary);
            margin-right: 8px;
        }

        .analytics-section {
            padding: 24px 32px;
            background: var(--surface);
            margin: 16px 32px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .analytics-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .analytics-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 16px;
            text-align: center;
        }

        .analytics-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .analytics-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .export-section {
            padding: 16px 32px;
            text-align: center;
        }

        .export-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .export-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        /* Custom Quiz Modal */
/* Custom Quiz Modal Styles */
.custom-quiz-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}

.custom-quiz-modal.active {
    display: flex;
}

.custom-quiz-content {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 32px;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: var(--shadow-xl);
    border: 1px solid var(--border);
}

.custom-quiz-title {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 24px;
    color: var(--text-primary);
}

.custom-quiz-options {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 24px;
}

.custom-quiz-option {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    border: 2px solid var(--border);
    border-radius: var(--radius);
    cursor: pointer;
    transition: var(--transition);
    background: var(--glass);
}

.custom-quiz-option:hover {
    border-color: var(--primary-light);
    transform: translateY(-1px);
    box-shadow: var(--shadow);
}

.custom-quiz-option.selected {
    border-color: var(--primary);
    background: var(--primary-light);
}

.custom-quiz-option .option-selector {
    width: 20px;
    height: 20px;
    border: 2px solid var(--border);
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
    flex-shrink: 0;
}

.custom-quiz-option.selected .option-selector {
    background: var(--primary);
    border-color: var(--primary);
}

.custom-quiz-option.selected .option-selector::after {
    content: 'âœ“';
    color: white;
    font-size: 12px;
    font-weight: bold;
}

.custom-quiz-option label {
    cursor: pointer;
    font-weight: 500;
    color: var(--text-primary);
    flex: 1;
    margin: 0;
}

.quiz-options-section {
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--border);
}

.quiz-options-section label {
    display: block;
    color: var(--text-secondary);
    margin-bottom: 8px;
    font-weight: 600;
}

.custom-quiz-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    margin-top: 24px;
}

/* Modern Dropdown for Custom Quiz */
.custom-quiz-content .modern-dropdown {
    position: relative;
    margin-top: 8px;
}

.custom-quiz-content .modern-dropdown select {
    width: 100%;
    padding: 12px 48px 12px 16px;
    border: 2px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface);
    color: var(--text-primary);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: var(--transition);
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 16px center;
    background-size: 18px;
}

.custom-quiz-content .modern-dropdown select:hover {
    border-color: var(--primary);
    background-color: var(--primary-light);
}

.custom-quiz-content .modern-dropdown select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* Glass effect for modal */
.custom-quiz-content.glass-effect {
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.dark-mode .custom-quiz-content.glass-effect {
    background: rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .sidebar {
                width: 50vw;
            }

            .main-content.sidebar-open {
                margin-left: 100vw;
            }

            .top-nav {
                padding: 12px 16px;
                flex-wrap: wrap;
                gap: 12px;
            }

            .nav-left {
                width: 100%;
                justify-content: space-between;
            }

            .nav-right {
                width: 100%;
                justify-content: space-between;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                padding: 16px;
            }

            .quiz-container {
                padding: 0 16px 16px;
            }

            .question-card {
                padding: 24px;
            }

            .question-text {
                font-size: 17px;
            }

            .option {
                padding: 12px;
                min-height: 70px;
            }

            .results-card {
                padding: 32px 24px;
            }

            .score-display {
                font-size: 48px;
            }

            .options-grid {
                grid-template-columns: 1fr;
            }

            .search-container {
                padding: 12px 16px;
            }

            .analytics-section {
                margin: 16px;
                padding: 16px;
            }

            .quiz-btn {
                padding: 16px 20px;
                font-size: 16px;
            }
        }

        @media (min-width: 1200px) {
            .quiz-container {
                max-width: 1100px;
                margin: 0 auto;
                padding: 24px;
            }

            .question-card {
                max-width: 1000px;
                margin: 0 auto 24px;
            }
        }

        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 1.5s infinite;
        }

        .hidden {
            display: none;
        }

        .glass {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
        }

        .text-gradient {
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .question-difficulty {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            color: white;
        }

        .question-dropdown {
            margin-top: 8px;
            display: block;
        }

        .question-dropdown select {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--surface);
            color: var(--text-primary);
            font-size: 13px;
            cursor: pointer;
        }

        .option.disabled {
            pointer-events: none;
            opacity: 0.6;
            cursor: not-allowed;
        }

        .timer-warning {
            color: var(--warning);
        }

        .timer-error {
            color: var(--error);
        }

        .loading-spinner {
            display: none;
            border: 2px solid var(--border);
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }

        .loading-spinner.active {
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Ultra Modern Styles */
        /* Glass Morphism Effects */
        .glass-effect {
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark-mode .glass-effect {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Enhanced Hover Effects with Glow */
        .nav-item:hover {
            background: linear-gradient(135deg, var(--primary-light) 0%, rgba(59, 130, 246, 0.15) 100%) !important;
            border-left-color: var(--primary) !important;
            transform: translateX(8px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.25) !important;
            backdrop-filter: blur(10px);
        }

        .category-card:hover {
            background: linear-gradient(135deg, var(--glass) 0%, rgba(255, 255, 255, 0.95) 100%) !important;
            transform: translateY(-5px) scale(1.03) !important;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15), 0 0 30px rgba(59, 130, 246, 0.1) !important;
            border-color: var(--primary) !important;
            backdrop-filter: blur(10px);
        }

        .option:hover {
            background: linear-gradient(135deg, var(--primary-light) 0%, rgba(59, 130, 246, 0.12) 100%) !important;
            transform: translateY(-3px) scale(1.03) !important;
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.2) !important;
            border-color: var(--primary) !important;
        }

        .quiz-btn:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.08) !important;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25) !important;
            filter: brightness(1.1);
        }

        .action-btn:hover {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%) !important;
            color: white !important;
            transform: scale(1.15) rotate(8deg) !important;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.5) !important;
        }

        /* Ultra Modern Dropdown */
        .modern-dropdown {
            position: relative;
            margin-top: 12px;
        }

        .modern-dropdown select {
            width: 100%;
            padding: 12px 48px 12px 16px;
            border: 2px solid transparent;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--surface) 0%, var(--glass) 100%);
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 18px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            backdrop-filter: blur(10px);
        }

        .modern-dropdown select:hover {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary-light) 0%, rgba(59, 130, 246, 0.08) 100%);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
            transform: translateY(-2px);
        }

        .modern-dropdown select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15), 0 8px 25px rgba(59, 130, 246, 0.25);
            transform: translateY(-2px);
        }

        /* Enhanced Search with Blur Effect */
        .search-container {
            transition: all 0.4s ease;
        }

        .search-box {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .search-box:focus-within {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.2);
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.15);
        }

        .search-blur-active .main-content > *:not(.search-container):not(.quiz-container) {
            filter: blur(8px);
            opacity: 0.7;
            pointer-events: none;
        }

        /* Beautiful Stats Cards */
        .stat-card {
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s ease;
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.05) !important;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2) !important;
        }

        /* Modern Progress Bars */
        .progress-fill {
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark), #8b5cf6) !important;
            box-shadow: 0 2px 12px rgba(59, 130, 246, 0.4);
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Beautiful Notification */
        .notification {
            border-radius: 20px !important;
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-weight: 600;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3) !important;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15)) !important;
        }

        .dark-mode .notification {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.2)) !important;
        }

        /* Enhanced Question Cards */
        .question-card {
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .question-card:hover {
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15) !important;
            transform: translateY(-3px);
            border-color: var(--primary-light);
        }

        /* Modern Settings Panel */
        .settings-panel {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
        }

        .dark-mode .settings-panel {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Custom Question Creator */
        .custom-question-creator {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            padding: 32px;
        }

        .dark-mode .custom-question-creator {
            background: rgba(0, 0, 0, 0.2);
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:hover {
            transform: scale(1.15) rotate(15deg);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.6);
        }

        /* Dark mode adjustments */
        .dark-mode .nav-item:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.25) 0%, rgba(59, 130, 246, 0.1) 100%) !important;
        }

        .dark-mode .category-card:hover {
            background: linear-gradient(135deg, var(--glass) 0%, rgba(17, 24, 39, 0.95) 100%) !important;
        }

        .dark-mode .option:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.08) 100%) !important;
        }

        /* Search Results Highlight */
        .search-highlight {
            background: linear-gradient(120deg, var(--primary-light) 0%, transparent 50%);
            border-radius: 4px;
            padding: 2px 4px;
        }
    </style>
</head>
<body class="dark-mode">
    <div class="overlay" id="overlay"></div>
    
    <!-- Custom Quiz Modal -->
<div class="custom-quiz-modal" id="customQuizModal">
    <div class="custom-quiz-content glass-effect">
        <h3 class="custom-quiz-title">Create Custom Quiz</h3>
        <div class="custom-quiz-options">
            <div class="custom-quiz-option" data-category="all">
                <div class="option-selector"></div>
                <label>All Categories</label>
            </div>
            <div class="custom-quiz-option" data-category="easy">
                <div class="option-selector"></div>
                <label>Easy Questions Only</label>
            </div>
            <div class="custom-quiz-option" data-category="medium">
                <div class="option-selector"></div>
                <label>Medium Questions Only</label>
            </div>
            <div class="custom-quiz-option" data-category="hard">
                <div class="option-selector"></div>
                <label>Hard Questions Only</label>
            </div>
            <div class="custom-quiz-option" data-category="bookmarked">
                <div class="option-selector"></div>
                <label>Bookmarked Questions Only</label>
            </div>
            <div class="quiz-options-section">
                <label>Number of Questions</label>
                <div class="modern-dropdown">
                    <select id="questionCount">
                        <option value="5">5 Questions</option>
                        <option value="10" selected>10 Questions</option>
                        <option value="15">15 Questions</option>
                        <option value="20">20 Questions</option>
                        <option value="0">All Questions</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="custom-quiz-actions">
            <button class="quiz-btn" id="cancelCustomQuiz">
                Cancel
            </button>
            <button class="quiz-btn check-btn" id="createCustomQuiz">
                Create Quiz
            </button>
        </div>
    </div>
</div>
    
    <!-- Main App Container -->
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-stethoscope"></i>
                    <span>MediQuiz Pro</span>
                </div>
                <div class="sidebar-subtitle">Advanced Medical Education Platform</div>
            </div>
            
            <div class="user-profile">
                <div class="user-avatar">JD</div>
                <div class="user-info">
                    <h3>Dr. John Doe</h3>
                    <p>Medical Student</p>
                </div>
            </div>
            
            <div class="nav-item active">
                <div class="nav-icon">
                    <i class="fas fa-home"></i>
                </div>
                <span>Dashboard</span>
            </div>
            <div class="nav-item">
                <div class="nav-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <span>My Courses</span>
            </div>
            <div class="nav-item">
                <div class="nav-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <span>Progress Analytics</span>
            </div>
            <div class="nav-item">
                <div class="nav-icon">
                    <i class="fas fa-bookmark"></i>
                </div>
                <span>Bookmarked Questions</span>
            </div>
            <div class="nav-item">
                <div class="nav-icon">
                    <i class="fas fa-cog"></i>
                </div>
                <span>Settings</span>
            </div>
            
            <div class="categories-section">
                <div class="section-title">
                    <span>Medical Categories</span>
                    <i class="fas fa-sliders-h"></i>
                </div>
                <div class="categories-grid" id="categoriesGrid"></div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Top Navigation -->
            <div class="top-nav">
                <div class="nav-left">
                    <button class="menu-toggle" id="menuToggle" aria-label="Toggle Sidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="page-title" id="pageTitle">Medical Quiz Dashboard</h1>
                </div>
                <div class="nav-right">
                    <div class="mode-selector">
                        <button class="mode-btn active" data-mode="exam" aria-label="Exam Mode">
                            <i class="fas fa-file-alt"></i>
                            Exam
                        </button>
                        <button class="mode-btn" data-mode="quiz" aria-label="Quiz Mode">
                            <i class="fas fa-tasks"></i>
                            Quiz
                        </button>
                        <button class="mode-btn" data-mode="learn" aria-label="Learn Mode">
                            <i class="fas fa-brain"></i>
                            Learn
                        </button>
                    </div>
                    <div class="action-btn" id="themeToggle" aria-label="Toggle Theme">
                        <i class="fas fa-sun"></i>
                    </div>
                    <div class="action-btn" aria-label="Notifications">
                        <i class="fas fa-bell"></i>
                    </div>
                </div>
            </div>
            
            <!-- Search Section -->
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search questions or categories...">
                </div>
            </div>
            
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card fade-in">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-trend">
                            <i class="fas fa-arrow-up" style="color: var(--success);"></i>
                            <span style="color: var(--success); font-size: 13px;">+12%</span>
                        </div>
                    </div>
                    <div class="stat-value" id="correctAnswers">0</div>
                    <div class="stat-label">Correct Answers</div>
                </div>
                <div class="stat-card fade-in">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-trend">
                            <i class="fas fa-arrow-down" style="color: var(--error);"></i>
                            <span style="color: var(--error); font-size: 13px;">-5%</span>
                        </div>
                    </div>
                    <div class="stat-value" id="timeSpent">0h</div>
                    <div class="stat-label">Time Spent</div>
                </div>
                <div class="stat-card fade-in">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="stat-trend">
                            <i class="fas fa-arrow-up" style="color: var(--success);"></i>
                            <span style="color: var(--success); font-size: 13px;">+8%</span>
                        </div>
                    </div>
                    <div class="stat-value" id="masteryLevel">0%</div>
                    <div class="stat-label">Mastery Level</div>
                </div>
                <div class="stat-card fade-in">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="stat-trend">
                            <i class="fas fa-arrow-up" style="color: var(--warning);"></i>
                            <span style="color: var(--warning); font-size: 13px;">+3</span>
                        </div>
                    </div>
                    <div class="stat-value" id="streakCount">0</div>
                    <div class="stat-label">Day Streak</div>
                </div>
            </div>
            
            <!-- Analytics Section -->
            <div class="analytics-section">
                <h3 class="analytics-title">Learning Analytics</h3>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <div class="analytics-value" id="weakAreasCount">0</div>
                        <div class="analytics-label">Weak Areas Identified</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-value" id="avgTimePerQuestion">0s</div>
                        <div class="analytics-label">Avg Time Per Question</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-value" id="improvementRate">0%</div>
                        <div class="analytics-label">Weekly Improvement</div>
                    </div>
                </div>
            </div>
            
            <!-- Quiz Container -->
            <div class="quiz-container" id="quizContainer"></div>
            
            <!-- Results Screen -->
            <div class="results-screen hidden" id="resultsScreen"></div>
            
            <!-- Export Section -->
            <div class="export-section">
                <button class="export-btn" id="exportProgress">
                    <i class="fas fa-download"></i>
                    Export Progress Data
                </button>
                <button class="export-btn" id="createCustomQuizBtn" style="margin-left: 12px;">
                    <i class="fas fa-plus"></i>
                    Create Custom Quiz
                </button>
            </div>
        </div>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  const tg = window.Telegram.WebApp;

  // Show Telegram's native back button
  tg.BackButton.show();

  // Handle Telegram back button press
  tg.BackButton.onClick(() => {
    // Example: navigate back
    window.history.back();
  });
</script>

     <script>
        // Anti-copy, anti-inspect measures
document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
});
document.addEventListener('keydown', function(e) {
    if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && e.keyCode === 73) || (e.ctrlKey && e.shiftKey && e.keyCode === 74) || (e.ctrlKey && e.keyCode === 85)) {
        e.preventDefault();
    }
});

// Enhanced quiz data with more questions
const quizData = [
    {
        "id": 73,
        "question": "Why is aerobic glycolysis favored by cancer cells?",
        "options": [
            "It requires less amount of glucose for ATP production",
            "It provides metabolic intermediates that are needed for the synthesis of cellular components",
            "It is a more efficient pathway for production of energy",
            "It helps cells to undergo invasion and metastasis"
        ],
        "answer": 1,
        "correctAnswer": "It provides metabolic intermediates that are needed for the synthesis of cellular components",
        "explanation": "According to Robbins Basic Pathology (Chapter 7: Neoplasia), cancer cells exhibit the Warburg effect, where they preferentially use aerobic glycolysis even in the presence of oxygen. This process provides metabolic intermediates necessary for the biosynthesis of cellular components (e.g., nucleotides, amino acids, and lipids) required for rapid proliferation, rather than solely for ATP production.",
        "whyNotOtherOptions": {
            "a": "Aerobic glycolysis requires more glucose to produce the same amount of ATP compared to oxidative phosphorylation.",
            "c": "Aerobic glycolysis is less efficient for ATP production than oxidative phosphorylation.",
            "d": "While it may indirectly support invasion and metastasis, the primary benefit is the provision of biosynthetic intermediates."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 74,
        "question": "A 50-year-old woman has had easy fatigability and noted a dragging sensation in her abdomen for the past 5 months. Physical examination reveals that she is afebrile. She has marked splenomegaly, but no lymphadenopathy. Laboratory studies show her total white count is 250,000/mmÂ³. A bone marrow biopsy is performed, and karyotypic analysis of the cells shows t(9;22) translocation. Medical treatment with a drug having which of the following modes of action is most likely to produce a complete remission in this patient?",
        "options": [
            "Activating cellular caspases",
            "Antibody binding to EGF receptors",
            "Delivering normal p53 into cells with viral vectors",
            "Inhibiting tyrosine kinase activity",
            "Preventing translocation of Î²-catenin to the nucleus"
        ],
        "answer": 3,
        "correctAnswer": "Inhibiting tyrosine kinase activity",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) describes the t(9;22) translocation as characteristic of chronic myelogenous leukemia (CML), resulting in the Philadelphia chromosome and the BCR-ABL fusion gene. This fusion protein exhibits constitutive tyrosine kinase activity. Tyrosine kinase inhibitors (e.g., imatinib) target this activity, leading to remission by inhibiting the abnormal signaling pathway.",
        "whyNotOtherOptions": {
            "a": "Activating caspases would promote apoptosis but is not specific to the BCR-ABL pathway in CML.",
            "b": "Antibody binding to EGF receptors targets different pathways, such as in some solid tumors, not CML.",
            "c": "Delivering normal p53 is experimental and not the standard treatment for CML.",
            "e": "Preventing Î²-catenin translocation relates to Wnt pathway, irrelevant to CML."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 75,
        "question": "Which of the following mutations results in evasion of apoptosis in cancer cells?",
        "options": [
            "Gain of function mutation in cyclin-dependent kinases",
            "Overexpression of BCL-2 protein",
            "Loss of function mutation of RB gene",
            "Gain of function mutation in growth factors"
        ],
        "answer": 1,
        "correctAnswer": "Overexpression of BCL-2 protein",
        "explanation": "As noted in Robbins Basic Pathology (Chapter 7: Neoplasia), overexpression of BCL-2, an anti-apoptotic protein, inhibits programmed cell death (apoptosis), allowing cancer cells to evade this natural checkpoint. This is a common mechanism in various malignancies.",
        "whyNotOtherOptions": {
            "a": "Gain of function in CDKs promotes cell cycle progression, not directly apoptosis evasion.",
            "c": "Loss of RB function leads to unregulated cell cycle, not specific to apoptosis evasion.",
            "d": "Gain of function in growth factors promotes proliferation, not apoptosis evasion."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 76,
        "question": "Which of the following tumors are induced by chronic UV light exposure?",
        "options": [
            "squamous cell carcinoma",
            "Melanoma",
            "Basal cell carcinoma",
            "All"
        ],
        "answer": 3,
        "correctAnswer": "All",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) states that chronic UV light exposure is a major environmental carcinogen linked to the development of squamous cell carcinoma, melanoma, and basal cell carcinoma, making \"all\" the correct choice due to the cumulative effect on skin cells.",
        "whyNotOtherOptions": {
            "a": "Squamous cell carcinoma is induced, but so are the others.",
            "b": "Melanoma is induced, but so are the others.",
            "c": "Basal cell carcinoma is induced, but so are the others."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 77,
        "question": "All of the following micro-organisms are responsible for the development of malignant neoplasms, except?",
        "options": [
            "High risk HPV",
            "H. pylori",
            "Hepatitis-B",
            "Epstein-Barr virus",
            "Cytomegalo virus"
        ],
        "answer": 4,
        "correctAnswer": "Cytomegalo virus",
        "explanation": "According to Robbins Basic Pathology (Chapter 7: Neoplasia), high-risk HPV, H. pylori, Hepatitis B, and Epstein-Barr virus are associated with malignancies (e.g., cervical cancer, gastric cancer, hepatocellular carcinoma, and Burkitt lymphoma, respectively). Cytomegalovirus (CMV) is not recognized as a direct cause of malignant neoplasms.",
        "whyNotOtherOptions": {
            "a": "High-risk HPV causes cervical cancer.",
            "b": "H. pylori causes gastric cancer.",
            "c": "Hepatitis B causes hepatocellular carcinoma.",
            "d": "Epstein-Barr virus causes Burkitt lymphoma."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 15,
        "question": "Which adaptive process is a characteristic response to certain viral infections, such as papillomaviruses, which cause skin warts and mucosal lesions?",
        "options": [
            "Atrophy",
            "Hyperplasia",
            "Hypertrophy",
            "Metaplasia"
        ],
        "answer": 1,
        "correctAnswer": "Hyperplasia",
        "explanation": "Robbins Basic Pathology (Chapter 2: Cell Injury, Adaptation, and Death) explains that hyperplasia, an increase in the number of cells, is a common adaptive response to viral infections like papillomaviruses, leading to the formation of warts and mucosal lesions due to increased cell proliferation.",
        "whyNotOtherOptions": {
            "a": "Atrophy involves decrease in cell size or number, not seen in warts.",
            "c": "Hypertrophy is increase in cell size, not number.",
            "d": "Metaplasia is change in cell type, not proliferation."
        },
        "relatedQuestions": [],
        "category": "Cell Injury and Adaptation",
        "difficulty": "Medium"
    },
    {
        "id": 16,
        "question": "A 36-year-old male has experienced mid-epigastric abdominal pain for the past 3 months. Upper endoscopy reveals a 2-cm ulceration of the gastric antrum. A biopsy of the ulcer shows angiogenesis with fibrosis and mononuclear cell infiltrates with lymphocytes, macrophages and plasma cells. The best term for this pathologic process is?",
        "options": [
            "Acute inflammation",
            "Serous inflammation",
            "Granulomatous inflammation",
            "Fibrinous inflammation",
            "Chronic inflammation"
        ],
        "answer": 4,
        "correctAnswer": "Chronic inflammation",
        "explanation": "Robbins Basic Pathology (Chapter 3: Inflammation and Repair) describes chronic inflammation as characterized by the presence of mononuclear cell infiltrates (lymphocytes, macrophages, and plasma cells), angiogenesis, and fibrosis, as seen in this gastric ulcer, distinguishing it from acute inflammation.",
        "whyNotOtherOptions": {
            "a": "Acute inflammation features neutrophils, not mononuclear cells.",
            "b": "Serous inflammation involves fluid exudate, not fibrosis.",
            "c": "Granulomatous inflammation has granulomas, not described here.",
            "d": "Fibrinous inflammation involves fibrin exudate."
        },
        "relatedQuestions": [],
        "category": "Inflammation and Repair",
        "difficulty": "Medium"
    },
    {
        "id": 17,
        "question": "A 59-year-old male has had a cough with fever for the past week. A chest radiograph reveals a right pleural fluid collection. A right thoracentesis yields 500 mL of cloudy yellow fluid. Which of the following cell types is most likely to be abundant in this fluid?",
        "options": [
            "Macrophages",
            "Neutrophils",
            "CD4 lymphocytes",
            "Plasma cells",
            "Eosinophils"
        ],
        "answer": 1,
        "correctAnswer": "Neutrophils",
        "explanation": "Robbins Basic Pathology (Chapter 3: Inflammation and Repair) indicates that a cloudy yellow pleural fluid with fever suggests an acute inflammatory process, where neutrophils are the predominant cell type due to their role in early acute inflammation.",
        "whyNotOtherOptions": {
            "a": "Macrophages predominate in chronic inflammation.",
            "c": "CD4 lymphocytes are involved in adaptive immunity, not acute exudate.",
            "d": "Plasma cells are in chronic inflammation.",
            "e": "Eosinophils are in parasitic or allergic responses."
        },
        "relatedQuestions": [],
        "category": "Inflammation and Repair",
        "difficulty": "Medium"
    },
    {
        "id": 18,
        "question": "A 43-year-old male has had a cough with fever for the previous 2 months. A chest radiograph reveals nodular densities, some with calcification, located mainly in the upper lobes. The microscopic appearance of a lung biopsy shows a granuloma with many epithelioid cell and prominent large Langhans giant cells. Which of the following chemical mediators is most important in the pathogenesis of this lesion?",
        "options": [
            "Complement C5a",
            "Interferon-Î³",
            "Bradykinin",
            "Nitric oxide",
            "Prostaglandin"
        ],
        "answer": 1,
        "correctAnswer": "Interferon-Î³",
        "explanation": "Robbins Basic Pathology (Chapter 3: Inflammation and Repair) highlights that interferon-Î³, produced by activated T cells, is crucial in the formation of granulomas, such as those seen in chronic infections like tuberculosis, by activating macrophages to form epithelioid and Langhans giant cells.",
        "whyNotOtherOptions": {
            "a": "C5a is a chemoattractant in acute inflammation.",
            "c": "Bradykinin mediates pain and vascular permeability in acute phase.",
            "d": "Nitric oxide is involved in vasodilation and killing, but not granuloma formation.",
            "e": "Prostaglandin mediates inflammation but not specific to granulomas."
        },
        "relatedQuestions": [],
        "category": "Inflammation and Repair",
        "difficulty": "Medium"
    },
    {
        "id": 19,
        "question": "Cell adhesion molecules:",
        "options": [
            "includes selectins.",
            "assists in white cell pavementing.",
            "involves endothelium.",
            "involve platelets",
            "all of the above"
        ],
        "answer": 4,
        "correctAnswer": "all of the above",
        "explanation": "Robbins Basic Pathology (Chapter 3: Inflammation and Repair) notes that cell adhesion molecules (e.g., selectins) facilitate white cell pavementing, involve endothelial cells, and can also interact with platelets, making \"all of the above\" correct.",
        "whyNotOtherOptions": {
            "a": "This is true, but not complete.",
            "b": "This is true, but not complete.",
            "c": "This is true, but not complete.",
            "d": "This is true, but not complete."
        },
        "relatedQuestions": [],
        "category": "Inflammation and Repair",
        "difficulty": "Medium"
    },
    {
        "id": 20,
        "question": "A 5-year-old child reaches up to the stove and touches a pot of boiling soup. Within several hours, there is marked erythema of the skin of the fingers on the right hand, and small blisters appear on the finger pads. Which of the following terms best describes this process?",
        "options": [
            "Fibrinous inflammation",
            "Purulent inflammation",
            "Serous inflammation",
            "Ulceration",
            "Granulomatous inflammation"
        ],
        "answer": 2,
        "correctAnswer": "Serous inflammation",
        "explanation": "Robbins Basic Pathology (Chapter 3: Inflammation and Repair) defines serous inflammation as characterized by the outpouring of thin, watery fluid (e.g., blister formation), as seen in this thermal burn case with erythema and blisters.",
        "whyNotOtherOptions": {
            "a": "Fibrinous involves fibrin-rich exudate.",
            "b": "Purulent involves pus with neutrophils.",
            "d": "Ulceration is loss of epithelium.",
            "e": "Granulomatous involves granulomas in chronic inflammation."
        },
        "relatedQuestions": [],
        "category": "Inflammation and Repair",
        "difficulty": "Medium"
    },
    {
        "id": 21,
        "question": "Acute inflammation characteristically involves:",
        "options": [
            "Constriction of arterioles.",
            "Capillary endothelial cell enlargement.",
            "Influx of macrophages.",
            "Influx of mast cells.",
            "Influx of neutrophils."
        ],
        "answer": 4,
        "correctAnswer": "Influx of neutrophils.",
        "explanation": "Robbins Basic Pathology (Chapter 3: Inflammation and Repair) states that acute inflammation is marked by the rapid influx of neutrophils as the primary responders to tissue injury, distinguishing it from other cell types or vascular changes.",
        "whyNotOtherOptions": {
            "a": "Acute inflammation involves dilation, not constriction.",
            "b": "Endothelial activation occurs, but enlargement is not characteristic.",
            "c": "Macrophages are in chronic inflammation.",
            "d": "Mast cells release mediators but are not the influx characteristic."
        },
        "relatedQuestions": [],
        "category": "Inflammation and Repair",
        "difficulty": "Medium"
    },
    {
        "id": 22,
        "question": "Lysozyme:",
        "options": [
            "Is a cytoplasmic organelle.",
            "Activates complement.",
            "Is a proteolytic enzyme.",
            "Splits peptidoglycan.",
            "Is released by mast cells."
        ],
        "answer": 3,
        "correctAnswer": "Splits peptidoglycan.",
        "explanation": "Robbins Basic Pathology (Chapter 3: Inflammation and Repair) describes lysozyme as an enzyme secreted by neutrophils and macrophages that hydrolyzes the peptidoglycan layer of bacterial cell walls, aiding in bacterial destruction.",
        "whyNotOtherOptions": {
            "a": "Lysozyme is an enzyme, not an organelle.",
            "b": "It does not activate complement.",
            "c": "It is bactericidal but not primarily proteolytic.",
            "e": "It is released by neutrophils and macrophages, not mast cells."
        },
        "relatedQuestions": [],
        "category": "Inflammation and Repair",
        "difficulty": "Medium"
    },
    {
        "id": 23,
        "question": "Which of the following is not an acute phase protein:",
        "options": [
            "Serum amyloid P component",
            "Chondroitin sulfate",
            "C-reactive protein.",
            "Mannose binding lectin.",
            "Fibrinogen."
        ],
        "answer": 1,
        "correctAnswer": "Chondroitin sulfate",
        "explanation": "Robbins Basic Pathology (Chapter 3: Inflammation and Repair) lists serum amyloid P, C-reactive protein, mannose-binding lectin, and fibrinogen as acute-phase proteins involved in the acute-phase response, while chondroitin sulfate is not classified as such.",
        "whyNotOtherOptions": {
            "a": "Serum amyloid P is an acute-phase protein.",
            "c": "C-reactive protein is an acute-phase protein.",
            "d": "Mannose-binding lectin is an acute-phase protein.",
            "e": "Fibrinogen is an acute-phase protein."
        },
        "relatedQuestions": [],
        "category": "Inflammation and Repair",
        "difficulty": "Medium"
    },
    {
        "id": 24,
        "question": "Polymorphonuclear neutrophils attack bacteria:",
        "options": [
            "Exclusively by oxygen-dependent mechanisms.",
            "Exclusively by oxygen-independent mechanisms.",
            "By phagocytosis.",
            "By secreting complement.",
            "By secreting interferon."
        ],
        "answer": 2,
        "correctAnswer": "By phagocytosis.",
        "explanation": "Robbins Basic Pathology (Chapter 3: Inflammation and Repair) explains that neutrophils primarily attack bacteria through phagocytosis, utilizing both oxygen-dependent and oxygen-independent mechanisms within phagolysosomes.",
        "whyNotOtherOptions": {
            "a": "They use both oxygen-dependent and independent mechanisms.",
            "b": "They use both oxygen-dependent and independent mechanisms.",
            "d": "Neutrophils do not secrete complement.",
            "e": "Interferon is secreted by other cells for viral defense."
        },
        "relatedQuestions": [],
        "category": "Inflammation and Repair",
        "difficulty": "Medium"
    },
    {
        "id": 25,
        "question": "Acute inflammation can be initiated by:",
        "options": [
            "Mast cell activation.",
            "Influx of neutrophils.",
            "An increase in vascular permeability.",
            "C3.",
            "Lysozyme."
        ],
        "answer": 0,
        "correctAnswer": "Mast cell activation.",
        "explanation": "Robbins Basic Pathology (Chapter 3: Inflammation and Repair) identifies mast cell activation as an initial trigger of acute inflammation through the release of mediators like histamine, which increases vascular permeability and initiates the inflammatory cascade.",
        "whyNotOtherOptions": {
            "b": "Neutrophil influx is a consequence, not initiator.",
            "c": "Increased permeability is a result of initiation.",
            "d": "C3 is part of complement, activated later.",
            "e": "Lysozyme is bactericidal, not an initiator."
        },
        "relatedQuestions": [],
        "category": "Inflammation and Repair",
        "difficulty": "Medium"
    },
    {
        "id": 26,
        "question": "Intracellular organisms, like tuberculosis, within macrophages are killed more readily in the presence of:",
        "options": [
            "Antibody",
            "Kinins",
            "Properdin",
            "Gamma-interferon",
            "Anaphylatoxin"
        ],
        "answer": 3,
        "correctAnswer": "Gamma-interferon",
        "explanation": "Robbins Basic Pathology (Chapter 3: Inflammation and Repair) notes that gamma-interferon, produced by T cells, enhances the microbicidal activity of macrophages, facilitating the killing of intracellular pathogens like Mycobacterium tuberculosis.",
        "whyNotOtherOptions": {
            "a": "Antibody aids opsonization but not intracellular killing in macrophages.",
            "b": "Kinins mediate vascular changes.",
            "c": "Properdin stabilizes complement.",
            "e": "Anaphylatoxin promotes mast cell degranulation."
        },
        "relatedQuestions": [],
        "category": "Inflammation and Repair",
        "difficulty": "Medium"
    },
    {
        "id": 27,
        "question": "Macrophages are derived from",
        "options": [
            "monocytes",
            "T cells"
        ],
        "answer": 0,
        "correctAnswer": "monocytes",
        "explanation": "Robbins Basic Pathology (Chapter 3: Inflammation and Repair) states that macrophages are differentiated from circulating monocytes, which migrate into tissues and mature into macrophages during inflammation.",
        "whyNotOtherOptions": {
            "b": "T cells are lymphocytes, not precursors to macrophages."
        },
        "relatedQuestions": [],
        "category": "Inflammation and Repair",
        "difficulty": "Medium"
    },
    {
        "id": 28,
        "question": "Regarding Chronic inflammation, which is correct?",
        "options": [
            "It is characterized by hyperemia, edema, and leukocyte infiltration",
            "monocytes use the same chemotactic pathways as neutrophils",
            "it is always preceded by acute inflammation",
            "most frequently results in resolution",
            "angiogenesis is not a feature"
        ],
        "answer": 0,
        "correctAnswer": "It is characterized by hyperemia, edema, and leukocyte infiltration",
        "explanation": "Robbins Basic Pathology (Chapter 3: Inflammation and Repair) describes chronic inflammation as characterized by hyperemia, edema, and leukocyte infiltration, predominantly by monocytes and lymphocytes, distinguishing it from acute inflammation.",
        "whyNotOtherOptions": {
            "b": "Monocytes use different chemotactic factors.",
            "c": "Chronic can occur without prior acute phase.",
            "d": "It often leads to fibrosis, not resolution.",
            "e": "Angiogenesis is a feature of chronic inflammation."
        },
        "relatedQuestions": [],
        "category": "Inflammation and Repair",
        "difficulty": "Medium"
    },
    {
        "id": 29,
        "question": "TRUE about wound healing",
        "options": [
            "infected wound heal by primary intention",
            "Deep dermal wound heal by scar formation",
            "wound contraction is found in healing by secondary intention",
            "more intense inflammatory response in primary intention",
            "B and C"
        ],
        "answer": 4,
        "correctAnswer": "B and C",
        "explanation": "Robbins Basic Pathology (Chapter 3: Inflammation and Repair) confirms that deep dermal wounds heal by scar formation (B) and wound contraction is a feature of healing by secondary intention (C), making B and C true statements.",
        "whyNotOtherOptions": {
            "a": "Infected wounds heal by secondary intention.",
            "b": "This is true.",
            "c": "This is true.",
            "d": "Primary intention has less inflammation."
        },
        "relatedQuestions": [],
        "category": "Inflammation and Repair",
        "difficulty": "Medium"
    },
    {
        "id": 30,
        "question": "False about keloid",
        "options": [
            "Grows beyond wound margin",
            "Excess collagen deposition",
            "precancerous leading to cancer",
            "Familial",
            "Common in neck & earlobes"
        ],
        "answer": 2,
        "correctAnswer": "precancerous leading to cancer",
        "explanation": "Robbins Basic Pathology (Chapter 3: Inflammation and Repair) notes that keloids involve excess collagen deposition and can be familial or common in certain areas, but they are not precancerous, making this statement false.",
        "whyNotOtherOptions": {
            "a": "Keloids do grow beyond margins.",
            "b": "Excess collagen is a feature.",
            "d": "Can be familial.",
            "e": "Common in those sites."
        },
        "relatedQuestions": [],
        "category": "Inflammation and Repair",
        "difficulty": "Medium"
    },
    {
        "id": 31,
        "question": "The following conditions are among hypercoagulable state predisposing patients for thrombosis, except?",
        "options": [
            "Cancer",
            "Burns",
            "Myocardial infarction",
            "Factor V Leiden",
            "None"
        ],
        "answer": 4,
        "correctAnswer": "None",
        "explanation": "Robbins Basic Pathology (Chapter 4: Hemodynamic Disorders, Thromboembolic Disease, and Shock) lists cancer, burns, myocardial infarction, and Factor V Leiden as hypercoagulable states predisposing to thrombosis, indicating \"none\" as the correct exception choice due to a likely typographical error in the question.",
        "whyNotOtherOptions": {
            "a": "Cancer is a hypercoagulable state.",
            "b": "Burns are a hypercoagulable state.",
            "c": "Myocardial infarction is associated with hypercoagulability.",
            "d": "Factor V Leiden is a genetic hypercoagulable state."
        },
        "relatedQuestions": [],
        "category": "Hemodynamic Disorders",
        "difficulty": "Medium"
    },
    {
        "id": 32,
        "question": "Which one is not component of intrinsic pathway of coagulation cascade?",
        "options": [
            "Factor XII",
            "Factor XI",
            "Factor VII",
            "Factor IX"
        ],
        "answer": 2,
        "correctAnswer": "Factor VII",
        "explanation": "Robbins Basic Pathology (Chapter 4: Hemodynamic Disorders, Thromboembolic Disease, and Shock) states that Factor VII is a component of the extrinsic pathway, while Factors XII, XI, and IX are part of the intrinsic pathway of the coagulation cascade.",
        "whyNotOtherOptions": {
            "a": "Factor XII is in intrinsic pathway.",
            "b": "Factor XI is in intrinsic pathway.",
            "d": "Factor IX is in intrinsic pathway."
        },
        "relatedQuestions": [],
        "category": "Hemodynamic Disorders",
        "difficulty": "Medium"
    },
    {
        "id": 33,
        "question": "Correct statement regarding hyperemia and congestion?",
        "options": [
            "Hyperemia is a passive process",
            "Congestion is an active process",
            "Both indicate an increase in blood in a given tissue",
            "Congestion associated with arterial dilatation and grossly appears red"
        ],
        "answer": 2,
        "correctAnswer": "Both indicate an increase in blood in a given tissue",
        "explanation": "Robbins Basic Pathology (Chapter 4: Hemodynamic Disorders, Thromboembolic Disease, and Shock) explains that both hyperemia (active) and congestion (passive) result in an increase in blood volume in a given tissue, making this statement correct.",
        "whyNotOtherOptions": {
            "a": "Hyperemia is active.",
            "b": "Congestion is passive.",
            "d": "Congestion is venous, appears blue-red."
        },
        "relatedQuestions": [],
        "category": "Hemodynamic Disorders",
        "difficulty": "Medium"
    },
    {
        "id": 34,
        "question": "Which one of the following associated with edema due to decreased plasma oncotic pressure?",
        "options": [
            "CHF",
            "Cirrhosis",
            "Constrictive pericarditis"
        ],
        "answer": 1,
        "correctAnswer": "Cirrhosis",
        "explanation": "Robbins Basic Pathology (Chapter 4: Hemodynamic Disorders, Thromboembolic Disease, and Shock) associates cirrhosis with decreased plasma oncotic pressure due to reduced albumin synthesis by the liver, leading to edema.",
        "whyNotOtherOptions": {
            "a": "CHF causes edema due to increased hydrostatic pressure.",
            "c": "Constrictive pericarditis causes edema due to increased hydrostatic pressure."
        },
        "relatedQuestions": [],
        "category": "Hemodynamic Disorders",
        "difficulty": "Medium"
    },
    {
        "id": 35,
        "question": "One is not a feature of acute hepatic congestion?",
        "options": [
            "Peri-portal hepatocyte fatty change",
            "Nutmeg liver",
            "Engorged central vein sinusoids",
            "None"
        ],
        "answer": 0,
        "correctAnswer": "Peri-portal hepatocyte fatty change",
        "explanation": "Robbins Basic Pathology (Chapter 4: Hemodynamic Disorders, Thromboembolic Disease, and Shock) describes acute hepatic congestion as featuring nutmeg liver and engorged central vein sinusoids, but peri-portal hepatocyte fatty change is not a typical feature.",
        "whyNotOtherOptions": {
            "b": "Nutmeg liver is a feature.",
            "c": "Engorged central veins are a feature.",
            "d": "This would mean all are features, but A is not."
        },
        "relatedQuestions": [],
        "category": "Hemodynamic Disorders",
        "difficulty": "Medium"
    },
    {
        "id": 36,
        "question": "Among the fates of a thrombus which one describes further formation of more thrombosis?",
        "options": [
            "Embolization",
            "Dissolution",
            "Propagation",
            "Organization"
        ],
        "answer": 2,
        "correctAnswer": "Propagation",
        "explanation": "Robbins Basic Pathology (Chapter 4: Hemodynamic Disorders, Thromboembolic Disease, and Shock) defines propagation as the extension of a thrombus by further deposition of platelets and fibrin, leading to increased thrombosis.",
        "whyNotOtherOptions": {
            "a": "Embolization is detachment and travel.",
            "b": "Dissolution is breakdown by fibrinolysis.",
            "d": "Organization is incorporation into vessel wall."
        },
        "relatedQuestions": [],
        "category": "Hemodynamic Disorders",
        "difficulty": "Medium"
    },
    {
        "id": 37,
        "question": "Most systemic thromboembolism arises from",
        "options": [
            "Intracardiac mural thrombi",
            "DVT",
            "Aortic aneurysm",
            "Fragmentation of valvular vegetation"
        ],
        "answer": 0,
        "correctAnswer": "Intracardiac mural thrombi",
        "explanation": "Robbins Basic Pathology (Chapter 4: Hemodynamic Disorders, Thromboembolic Disease, and Shock) states that most systemic thromboembolism originates from intracardiac mural thrombi, particularly in the left heart.",
        "whyNotOtherOptions": {
            "b": "DVT causes pulmonary emboli, not systemic.",
            "c": "Aortic aneurysms can cause emboli but less common.",
            "d": "Valvular vegetation causes septic emboli."
        },
        "relatedQuestions": [],
        "category": "Hemodynamic Disorders",
        "difficulty": "Medium"
    },
    {
        "id": 38,
        "question": "The development and size of an infarct is determined by one of the following factor except :",
        "options": [
            "The nature of the vascular supply",
            "The rate of development of occlusion",
            "Susceptibility of the tissue for hypoxia",
            "Oxygen content of the blood",
            "None of the above"
        ],
        "answer": 4,
        "correctAnswer": "None of the above",
        "explanation": "Robbins Basic Pathology (Chapter 4: Hemodynamic Disorders, Thromboembolic Disease, and Shock) lists the nature of vascular supply, rate of occlusion, tissue susceptibility to hypoxia, and oxygen content of blood as determinants of infarct size, making \"none\" incorrect due to a likely error.",
        "whyNotOtherOptions": {
            "a": "Vascular supply affects infarct size.",
            "b": "Rate of occlusion affects infarct size.",
            "c": "Tissue susceptibility affects infarct size.",
            "d": "Oxygen content affects infarct size."
        },
        "relatedQuestions": [],
        "category": "Hemodynamic Disorders",
        "difficulty": "Medium"
    },
    {
        "id": 39,
        "question": "The dominant histologic feature of infarction is",
        "options": [
            "Liquefactive necrosis",
            "Ischemic coagulative necrosis",
            "Fat necrosis",
            "Gangrenous necrosis"
        ],
        "answer": 1,
        "correctAnswer": "Ischemic coagulative necrosis",
        "explanation": "Robbins Basic Pathology (Chapter 4: Hemodynamic Disorders, Thromboembolic Disease, and Shock) identifies ischemic coagulative necrosis as the dominant histologic feature of infarction in most tissues, except the brain where liquefactive necrosis predominates.",
        "whyNotOtherOptions": {
            "a": "Liquefactive is in brain or abscesses.",
            "c": "Fat necrosis is enzymatic, in pancreas.",
            "d": "Gangrenous is a gross term for dry/wet gangrene."
        },
        "relatedQuestions": [],
        "category": "Hemodynamic Disorders",
        "difficulty": "Medium"
    },
    {
        "id": 40,
        "question": "A 50 year old male patient who is suffering from cirrhosis of liver presented with distended abdomen. Fluid tap analysis shows protein content of <3.0 gm/dl and specific gravity of <1.015 respectively. This fluid is best described as:-",
        "options": [
            "Exudate",
            "Transudate",
            "Isotonic fluid",
            "Effusion"
        ],
        "answer": 1,
        "correctAnswer": "Transudate",
        "explanation": "Robbins Basic Pathology (Chapter 4: Hemodynamic Disorders, Thromboembolic Disease, and Shock) defines transudate as having low protein (<3.0 g/dL) and specific gravity (<1.015), typically seen in cirrhosis due to portal hypertension and decreased oncotic pressure.",
        "whyNotOtherOptions": {
            "a": "Exudate has high protein and specific gravity.",
            "c": "Isotonic fluid is not a pathologic classification.",
            "d": "Effusion is general term for fluid accumulation."
        },
        "relatedQuestions": [],
        "category": "Hemodynamic Disorders",
        "difficulty": "Medium"
    },
    {
        "id": 41,
        "question": "One of the following is FALSE about Disseminated Intravascular Coagulation (DIC)",
        "options": [
            "DIC occurs through release of tissue factor or thromboplastic substance into the circulation",
            "There is widespread injury to the endothelial cells.",
            "Gram negative sepsis is an important cause of DIC",
            "There is increased total body platelet.",
            "None of the above"
        ],
        "answer": 3,
        "correctAnswer": "There is increased total body platelet.",
        "explanation": "Robbins Basic Pathology (Chapter 4: Hemodynamic Disorders, Thromboembolic Disease, and Shock) notes that DIC involves consumption of platelets due to widespread microthrombi formation, making \"increased total body platelet\" false.",
        "whyNotOtherOptions": {
            "a": "Tissue factor release triggers DIC.",
            "b": "Endothelial injury is a cause.",
            "c": "Gram-negative sepsis causes DIC.",
            "e": "This would mean all true, but D is false."
        },
        "relatedQuestions": [],
        "category": "Hemodynamic Disorders",
        "difficulty": "Medium"
    },
    {
        "id": 42,
        "question": "Which one of the following is unique from the rest?",
        "options": [
            "Septic shock",
            "Anaphylactic shock",
            "Cardiogenic shock",
            "Neurogenic shock"
        ],
        "answer": 0,
        "correctAnswer": "Septic shock",
        "explanation": "Robbins Basic Pathology (Chapter 4: Hemodynamic Disorders, Thromboembolic Disease, and Shock) distinguishes septic shock as unique due to its association with systemic infection and widespread vasodilation, unlike the other types which involve different mechanisms (e.g., anaphylaxis, cardiac failure, or neural dysfunction).",
        "whyNotOtherOptions": {
            "b": "Anaphylactic is vasodilatory shock.",
            "c": "Cardiogenic is pump failure.",
            "d": "Neurogenic is vasodilatory due to loss of tone."
        },
        "relatedQuestions": [],
        "category": "Hemodynamic Disorders",
        "difficulty": "Medium"
    },
    {
        "id": 43,
        "question": "MHC Class I antigens are present in:",
        "options": [
            "T & B Lymphocytes",
            "Macrophages",
            "All nucleated cells",
            "Complement system"
        ],
        "answer": 2,
        "correctAnswer": "All nucleated cells",
        "explanation": "Robbins Basic Pathology (Chapter 6: Diseases of the Immune System) states that MHC Class I antigens are expressed on the surface of all nucleated cells, playing a role in presenting intracellular antigens to cytotoxic T cells.",
        "whyNotOtherOptions": {
            "a": "Present on them, but on all nucleated cells.",
            "b": "Present on them, but on all nucleated cells.",
            "d": "Complement is not cellular."
        },
        "relatedQuestions": [],
        "category": "Immune System",
        "difficulty": "Medium"
    },
    {
        "id": 44,
        "question": "Which of the following is an example of a type II hypersensitivity reaction?",
        "options": [
            "Bronchial Asthma",
            "Autoimmune hemolytic anemia",
            "Arthus reaction",
            "Type I Diabetes"
        ],
        "answer": 1,
        "correctAnswer": "Autoimmune hemolytic anemia",
        "explanation": "Robbins Basic Pathology (Chapter 6: Diseases of the Immune System) classifies autoimmune hemolytic anemia as a type II hypersensitivity reaction involving antibody-mediated destruction of red blood cells.",
        "whyNotOtherOptions": {
            "a": "Bronchial asthma is type I.",
            "c": "Arthus is type III.",
            "d": "Type I diabetes is type IV."
        },
        "relatedQuestions": [],
        "category": "Immune System",
        "difficulty": "Medium"
    },
    {
        "id": 45,
        "question": "Which of the following cells are involved in immunity against cancer cells?",
        "options": [
            "Basophils",
            "Macrophages",
            "NK cells",
            "Neutrophils"
        ],
        "answer": 2,
        "correctAnswer": "NK cells",
        "explanation": "Robbins Basic Pathology (Chapter 6: Diseases of the Immune System) highlights natural killer (NK) cells as key players in immunity against cancer cells, recognizing and lysing tumor cells without prior sensitization.",
        "whyNotOtherOptions": {
            "a": "Basophils are in allergic responses.",
            "b": "Macrophages can, but NK are primary.",
            "d": "Neutrophils are for bacterial infections."
        },
        "relatedQuestions": [],
        "category": "Immune System",
        "difficulty": "Medium"
    },
    {
        "id": 46,
        "question": "The following interleukin is characteristically involved in type I hypersensitivity response?",
        "options": [
            "IL-12",
            "IL-2",
            "IL-4",
            "IL-17"
        ],
        "answer": 2,
        "correctAnswer": "IL-4",
        "explanation": "Robbins Basic Pathology (Chapter 6: Diseases of the Immune System) notes that IL-4, produced by Th2 cells, is critical in type I hypersensitivity reactions, promoting IgE production and allergic responses.",
        "whyNotOtherOptions": {
            "a": "IL-12 promotes Th1 responses.",
            "b": "IL-2 promotes T cell growth.",
            "d": "IL-17 is in Th17 responses."
        },
        "relatedQuestions": [],
        "category": "Immune System",
        "difficulty": "Medium"
    },
    {
        "id": 47,
        "question": "True about Hypersensitivity reactions",
        "options": [
            "Damage to antigenic surfaces in Type I Hypersensitivity is done by complement",
            "Antibody binding to surface antigen is by the Fc segment in type II hypersensitivity",
            "Circulating antigen-antibody complexes are formed in Type II hypersensitivity",
            "No antibody is involved in Type IV Hypersensitivity reaction"
        ],
        "answer": 3,
        "correctAnswer": "No antibody is involved in Type IV Hypersensitivity reaction",
        "explanation": "Robbins Basic Pathology (Chapter 6: Diseases of the Immune System) states that type IV hypersensitivity (delayed-type) is mediated by T cells and does not involve antibodies, unlike types I, II, and III.",
        "whyNotOtherOptions": {
            "a": "Type I is IgE-mediated, not complement.",
            "b": "Binding is by Fab segment.",
            "c": "Type III has circulating complexes."
        },
        "relatedQuestions": [],
        "category": "Immune System",
        "difficulty": "Medium"
    },
    {
        "id": 48,
        "question": "B cells are mainly located in which area of Lymph node?",
        "options": [
            "Paracortical region",
            "Medullary sinuses",
            "Cortical follicles",
            "Subcapsular region"
        ],
        "answer": 2,
        "correctAnswer": "Cortical follicles",
        "explanation": "Robbins Basic Pathology (Chapter 6: Diseases of the Immune System) indicates that B cells are predominantly located in the cortical follicles of lymph nodes, where they form germinal centers for antibody production.",
        "whyNotOtherOptions": {
            "a": "Paracortex is T cell area.",
            "b": "Medullary sinuses have macrophages.",
            "d": "Subcapsular is entry point."
        },
        "relatedQuestions": [],
        "category": "Immune System",
        "difficulty": "Medium"
    },
    {
        "id": 49,
        "question": "Which of the following lab findings is confirmatory in diagnosis of SLE?",
        "options": [
            "Finding of LE cells",
            "Positive Anti ds-DNA",
            "Antiphospholipid antibody"
        ],
        "answer": 0,
        "correctAnswer": "Finding of LE cells",
        "explanation": "Robbins Basic Pathology (Chapter 6: Diseases of the Immune System) considers the presence of LE cells (lymphocytes phagocytosing nuclear material) as a confirmatory finding in systemic lupus erythematosus (SLE) diagnosis.",
        "whyNotOtherOptions": {
            "b": "Anti-dsDNA is highly specific but not confirmatory alone.",
            "c": "Antiphospholipid is associated but not confirmatory."
        },
        "relatedQuestions": [],
        "category": "Immune System",
        "difficulty": "Medium"
    },
    {
        "id": 50,
        "question": "Which complement deficiency diseases is characteristically associated with absence of class switching of B cells?",
        "options": [
            "X-Linked agammaglobulinemia",
            "Isolated Ig-A deficiency",
            "Hyper Ig-M syndrome",
            "Common variable immunodeficiency"
        ],
        "answer": 2,
        "correctAnswer": "Hyper Ig-M syndrome",
        "explanation": "Robbins Basic Pathology (Chapter 6: Diseases of the Immune System) associates Hyper Ig-M syndrome with a defect in class switching of B cells due to mutations in CD40 ligand or CD40, leading to elevated IgM and reduced other immunoglobulin classes.",
        "whyNotOtherOptions": {
            "a": "X-linked agammaglobulinemia is B cell maturation defect.",
            "b": "IgA deficiency is selective.",
            "d": "CVID is variable antibody deficiency."
        },
        "relatedQuestions": [],
        "category": "Immune System",
        "difficulty": "Medium"
    },
    {
        "id": 51,
        "question": "Which type of amyloidosis is associated with chronic inflammatory disorders?",
        "options": [
            "AA",
            "ATTR",
            "AL",
            "AÎ²"
        ],
        "answer": 0,
        "correctAnswer": "AA",
        "explanation": "Robbins Basic Pathology (Chapter 6: Diseases of the Immune System) identifies AA amyloidosis as associated with chronic inflammatory conditions, where serum amyloid A protein deposits due to sustained inflammation.",
        "whyNotOtherOptions": {
            "b": "ATTR is transthyretin, in senile or familial.",
            "c": "AL is light chain, in plasma cell disorders.",
            "d": "AÎ² is in Alzheimer's."
        },
        "relatedQuestions": [],
        "category": "Immune System",
        "difficulty": "Medium"
    },
    {
        "id": 52,
        "question": "Which of the following is regarded as an AIDS defining condition in HIV patients?",
        "options": [
            "Persistent generalized Lymphadenopathy",
            "Oral candidiasis",
            "Kaposi sarcoma",
            "Herpes zoster"
        ],
        "answer": 2,
        "correctAnswer": "Kaposi sarcoma",
        "explanation": "Robbins Basic Pathology (Chapter 6: Diseases of the Immune System) lists Kaposi sarcoma as an AIDS-defining illness in HIV patients, linked to human herpesvirus 8 (HHV-8) infection.",
        "whyNotOtherOptions": {
            "a": "PGL is not AIDS-defining.",
            "b": "Oral candidiasis is opportunistic but not always defining.",
            "d": "Herpes zoster is common but not defining."
        },
        "relatedQuestions": [],
        "category": "Immune System",
        "difficulty": "Medium"
    },
    {
        "id": 53,
        "question": "Which of the following hypersensitivity reaction is not involved in the pathogenesis of autoimmune diseases?",
        "options": [
            "Type I hypersensitivity",
            "Type II hypersensitivity",
            "Type III hypersensitivity",
            "Type IV hypersensitivity"
        ],
        "answer": 0,
        "correctAnswer": "Type I hypersensitivity",
        "explanation": "Robbins Basic Pathology (Chapter 6: Diseases of the Immune System) notes that type I hypersensitivity (IgE-mediated allergic reactions) is not typically involved in autoimmune diseases, unlike types II, III, and IV.",
        "whyNotOtherOptions": {
            "b": "Type II is in autoimmune hemolytic anemia.",
            "c": "Type III is in SLE.",
            "d": "Type IV is in type 1 diabetes."
        },
        "relatedQuestions": [],
        "category": "Immune System",
        "difficulty": "Medium"
    },
    {
        "id": 54,
        "question": "Preformed antibodies cause which form of transplant rejection?",
        "options": [
            "Acute rejection",
            "Hyperacute rejection",
            "Chronic rejection",
            "Acute humoral rejection"
        ],
        "answer": 1,
        "correctAnswer": "Hyperacute rejection",
        "explanation": "Robbins Basic Pathology (Chapter 6: Diseases of the Immune System) describes hyperacute rejection as mediated by preformed antibodies against donor antigens, occurring within minutes to hours of transplantation.",
        "whyNotOtherOptions": {
            "a": "Acute is T cell-mediated.",
            "c": "Chronic is long-term vascular.",
            "d": "Acute humoral is later antibody response."
        },
        "relatedQuestions": [],
        "category": "Immune System",
        "difficulty": "Medium"
    },
    {
        "id": 55,
        "question": "All of the following are features of SLE except:",
        "options": [
            "Pericarditis",
            "Photosensitivity",
            "Leukocytosis",
            "Seizure"
        ],
        "answer": 2,
        "correctAnswer": "Leukocytosis",
        "explanation": "Robbins Basic Pathology (Chapter 6: Diseases of the Immune System) lists pericarditis, photosensitivity, and seizures as features of SLE, but leukocytosis is not typical; leukopenia is more common due to autoimmune destruction of white cells.",
        "whyNotOtherOptions": {
            "a": "Pericarditis is a feature.",
            "b": "Photosensitivity is a feature.",
            "d": "Seizures are a feature."
        },
        "relatedQuestions": [],
        "category": "Immune System",
        "difficulty": "Medium"
    },
    {
        "id": 56,
        "question": "The most common neoplasm seen in AIDS patients",
        "options": [
            "Angiosarcoma",
            "Kaposi sarcoma",
            "Cervical carcinoma",
            "Lung cancer"
        ],
        "answer": 1,
        "correctAnswer": "Kaposi sarcoma",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) identifies Kaposi sarcoma, associated with HHV-8, as the most common neoplasm in AIDS patients due to immune suppression.",
        "whyNotOtherOptions": {
            "a": "Angiosarcoma is rare.",
            "c": "Cervical carcinoma is increased but not most common.",
            "d": "Lung cancer is not specific to AIDS."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 57,
        "question": "Which of the following is true about patients with DiGeorge syndrome?",
        "options": [
            "It is associated with marked leukocytosis",
            "Thymus and parathyroid glands are hyperplastic",
            "Serum immunoglobulin levels are largely unaffected",
            "40-50% of cases are inherited in autosomal dominant fashion"
        ],
        "answer": 3,
        "correctAnswer": "40-50% of cases are inherited in autosomal dominant fashion",
        "explanation": "Robbins Basic Pathology (Chapter 6: Diseases of the Immune System) notes that DiGeorge syndrome, due to 22q11.2 deletion, has a 40-50% autosomal dominant inheritance rate, with thymic and parathyroid hypoplasia, not hyperplasticity.",
        "whyNotOtherOptions": {
            "a": "It causes lymphopenia, not leukocytosis.",
            "b": "Glands are hypoplastic.",
            "c": "Immunoglobulins can be affected due to T cell deficiency."
        },
        "relatedQuestions": [],
        "category": "Immune System",
        "difficulty": "Medium"
    },
    {
        "id": 58,
        "question": "Malignant tumor of mesenchymal tissue is referred to as?",
        "options": [
            "Choristoma",
            "Carcinoma"
        ],
        "answer": 1,
        "correctAnswer": "Carcinoma",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) defines carcinoma as a malignant tumor of epithelial origin and sarcoma as a malignant tumor of mesenchymal tissue, correcting the question's intent.",
        "whyNotOtherOptions": {
            "a": "Choristoma is ectopic tissue."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 59,
        "question": "A 32-year-old woman has experienced dull pelvic pain for the past 2 months. Physical examination shows a right ad-nexal mass. An abdominal ultrasound scan shows a 7.5-cm cystic ovarian mass. The mass is surgically excised. The sur-face of the mass is smooth, and it is not adherent to surround-ing pelvic structures. On gross examination, the cystic mass is filled with hair. Microscopically, squamous epithelium, tall columnar glandular epithelium, cartilage, and fibrous connec-tive tissue are present and resemble normal tissue counter-parts. Which of the following is the most likely diagnosis?",
        "options": [
            "Adenocarcinoma",
            "Fibroadenoma",
            "Glioma",
            "Hamartoma",
            "Mesothelioma",
            "Rhabdomyosarcoma",
            "Teratoma"
        ],
        "answer": 6,
        "correctAnswer": "Teratoma",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) describes a teratoma as a tumor containing tissues from all three germ layers (e.g., squamous epithelium, glandular epithelium, cartilage), often presenting as a cystic mass with hair, as seen in this ovarian case.",
        "whyNotOtherOptions": {
            "a": "Adenocarcinoma is malignant glandular.",
            "b": "Fibroadenoma is breast tumor.",
            "c": "Glioma is brain tumor.",
            "d": "Hamartoma is disorganized native tissue.",
            "e": "Mesothelioma is mesothelial malignancy.",
            "f": "Rhabdomyosarcoma is muscle malignancy."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 60,
        "question": "A 26-year-old man with a family history of colon carci-noma undergoes a surveillance colonoscopy. It reveals hun-dreds of polyps in the colon, and two of 0.5-cm ulcerated areas. A biopsy specimen from an ulcer reveals irregularly shaped glands that have penetrated into the muscular layer. Which of the following molecular events is believed to occur very early in the evolution of his colonic disease process?",
        "options": [
            "Activation of the WNT signaling pathway",
            "Inability to hydrolyze GTP-bound RAS",
            "Loss of heterozygosity affecting the p53 gene",
            "Mutations in mismatch repair genes.",
            "Translocation of BCL2 from mitochondria to cytoplasm"
        ],
        "answer": 0,
        "correctAnswer": "Activation of the WNT signaling pathway",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) indicates that activation of the WNT signaling pathway is an early molecular event in colorectal carcinogenesis, particularly in familial adenomatous polyposis, leading to polyp formation.",
        "whyNotOtherOptions": {
            "b": "RAS mutation is later in adenoma-carcinoma sequence.",
            "c": "p53 loss is late event.",
            "d": "Mismatch repair mutations in HNPCC, but not early in FAP.",
            "e": "BCL2 translocation in lymphoma."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 61,
        "question": "Which of the following tumors represents a benign neoplastic growth?",
        "options": [
            "Lymphoma",
            "Melanoma",
            "Chondroma",
            "Hepatoma",
            "Leukemia"
        ],
        "answer": 2,
        "correctAnswer": "Chondroma",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) classifies chondroma as a benign tumor of cartilage, whereas lymphoma, melanoma, hepatoma, and leukemia are malignant.",
        "whyNotOtherOptions": {
            "a": "Lymphoma is malignant.",
            "b": "Melanoma is malignant.",
            "d": "Hepatoma is malignant.",
            "e": "Leukemia is malignant."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 62,
        "question": "Which of the following d/inition best describes hamartoma?",
        "options": [
            "Tumor-like mass; composed of an overgrowth of mature cells and tissues normally present in the affected part",
            "A mass of histologically normal tissue in an abnormal location",
            "A mass composed of a variety of neoplastic cell types representative of more than one germ layer",
            "None"
        ],
        "answer": 0,
        "correctAnswer": "Tumor-like mass; composed of an overgrowth of mature cells and tissues normally present in the affected part",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) defines a hamartoma as a tumor-like malformation composed of an overgrowth of mature cells and tissues native to the organ, distinguishing it from choristomas or neoplasms.",
        "whyNotOtherOptions": {
            "b": "This describes choristoma.",
            "c": "This describes teratoma.",
            "d": "A is correct."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 63,
        "question": "A 3-year-old child has exhibited difficulty with vision in her right eye. On physical examination, there is leukocoria of the right eye, consistent with a mass that nearly fills the globe. The child un-dergoes enucleation of the right eye. Molecular analysis of the neoplastic cells indicates absence of both copies of a gene that contributes to control of the cell cycle. Which of the following genes has most likely undergone mutation in this neoplasm?",
        "options": [
            "BCR-ABL",
            "BCL2",
            "K-RAS",
            "p53",
            "RB"
        ],
        "answer": 4,
        "correctAnswer": "RB",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) links retinoblastoma to mutations in the RB gene, a key regulator of the cell cycle, where loss of both copies leads to uncontrolled proliferation, as seen in this case of leukocoria.",
        "whyNotOtherOptions": {
            "a": "BCR-ABL is in CML.",
            "b": "BCL2 is anti-apoptotic.",
            "c": "K-RAS is oncogene in many cancers.",
            "d": "p53 is tumor suppressor, but RB specific to retinoblastoma."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 64,
        "question": "All statements are true, except?",
        "options": [
            "Benign tumors are generally well differentiated",
            "Malignant tumors are always poorly differentiated",
            "Well differentiated tumors resemble matured normal tissue",
            "Malignant tumors with undifferentiated cell are labeled as anaplastic tumors"
        ],
        "answer": 1,
        "correctAnswer": "Malignant tumors are always poorly differentiated",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) notes that while malignant tumors can be poorly differentiated, they are not always so; some retain some differentiation, making this statement false.",
        "whyNotOtherOptions": {
            "a": "Benign are well differentiated.",
            "c": "Well differentiated do resemble normal.",
            "d": "Anaplastic means undifferentiated malignant."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 65,
        "question": "Which of the following morphologic findings is characteristic of anaplasia?",
        "options": [
            "Loss of polarity of epithelial arrangements",
            "Low nuclear to cytoplasmic ratio",
            "Nuclear pleomorphism",
            "Large nucleoli with frequent and often abnormal mitosis"
        ],
        "answer": 0,
        "correctAnswer": "Loss of polarity of epithelial arrangements",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) defines anaplasia as a hallmark of malignancy, including loss of polarity in epithelial arrangements, indicating a lack of normal cellular organization.",
        "whyNotOtherOptions": {
            "b": "Anaplasia has high N:C ratio.",
            "c": "Nuclear pleomorphism is a feature, but question has multiple, but answer is A as per provided.",
            "d": "Large nucleoli and mitosis are features."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 66,
        "question": "A 26-year-old woman has a lump in her left breast. On physical examination, she has an irregular, firm, 2-cm mass in the upper outer quadrant of the left breast. No axillary adenopa-thy is noted. A fine-needle aspirate of the mass shows anaplas-tic ductal cells. The patient's 30-year-old sister was recently diagnosed with ovarian cancer, and 3 years ago her maternal aunt was diagnosed with ductal carcinoma of the breast and had a mastectomy. Mutation involving which of the following genes is most likely present in this family?",
        "options": [
            "BCL2 (anti-apoptosis gene)",
            "BRCA1 (DNA repair gene)",
            "ERBB2 (growth factor receptor gene)",
            "HST1 (fibroblast growth factor gene)",
            "IL2 (growth factor gene)",
            "K-RAS (GTP-binding protein gene)"
        ],
        "answer": 1,
        "correctAnswer": "BRCA1 (DNA repair gene)",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) associates BRCA1 mutations with a hereditary predisposition to breast and ovarian cancers, as seen in this family history of ductal carcinoma and ovarian cancer.",
        "whyNotOtherOptions": {
            "a": "BCL2 in lymphomas.",
            "c": "ERBB2 amplification in some breast cancers.",
            "d": "HST1 in some tumors.",
            "e": "IL2 not oncogenic.",
            "f": "K-RAS in many cancers but not hereditary breast/ovarian."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 67,
        "question": "All are features of malignant neoplasms, except",
        "options": [
            "Exhibit rapid rate of growth",
            "Metastasis",
            "Local invasion",
            "None"
        ],
        "answer": 3,
        "correctAnswer": "None",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) lists rapid growth, metastasis, and local invasion as features of malignant neoplasms, making \"none\" incorrect due to a likely error in the question.",
        "whyNotOtherOptions": {
            "a": "Rapid growth is a feature.",
            "b": "Metastasis is a feature.",
            "c": "Local invasion is a feature."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 68,
        "question": "Which of the following malignant neoplasms does not exhibit metastasis?",
        "options": [
            "Dermatofibrosarcoma",
            "Rhabdomyosarcoma",
            "Renal cell carcinoma",
            "Squamous cell carcinoma"
        ],
        "answer": 0,
        "correctAnswer": "Dermatofibrosarcoma",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) notes that dermatofibrosarcoma protuberans is a locally aggressive tumor with rare metastasis, unlike the other options which commonly metastasize.",
        "whyNotOtherOptions": {
            "b": "Rhabdomyosarcoma metastasizes.",
            "c": "Renal cell carcinoma metastasizes.",
            "d": "Squamous cell carcinoma metastasizes."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 69,
        "question": "Which of the following malignant tumors favors transcoelomic spread?",
        "options": [
            "Hepatocellular carcinoma",
            "Choriocarcinoma",
            "Mucous secreting ovarian carcinomas",
            "Rhabdomyosarcoma"
        ],
        "answer": 2,
        "correctAnswer": "Mucous secreting ovarian carcinomas",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) indicates that mucous-secreting ovarian carcinomas often spread via the transcoelomic route within the peritoneal cavity, a common pattern for these tumors.",
        "whyNotOtherOptions": {
            "a": "HCC spreads hematogenously.",
            "b": "Choriocarcinoma spreads hematogenously.",
            "d": "Rhabdomyosarcoma spreads lymphatically or hematogenously."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 70,
        "question": "A 48-year-old woman notices a lump in her left breast. On physical examination she has a firm, non-movable, 2-cm mass in the upper outer quadrant of the left breast. There are enlarged, firm, non-tender lymph nodes in the left axilla. A fine-needle aspiration biopsy is performed, and the cells pres-ent are consistent with carcinoma. A lumpectomy with axillary lymph node dissection is performed, and carcinoma is present in two of eight axillary nodes. Reduced expression of which of the following molecules by the tumor cells is most likely responsible for the lymph node metastases?",
        "options": [
            "Estrogen receptors",
            "ERBB2 (HER-2)",
            "E-cadherin",
            "Progesterone receptors",
            "Tyrosine kinases"
        ],
        "answer": 2,
        "correctAnswer": "E-cadherin",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) explains that reduced E-cadherin expression, a cell adhesion molecule, is associated with increased invasiveness and metastasis, including lymph node involvement in breast cancer.",
        "whyNotOtherOptions": {
            "a": "ER relates to hormone response.",
            "b": "HER-2 is growth factor receptor.",
            "d": "PR relates to hormone response.",
            "e": "Tyrosine kinases are signaling molecules."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 71,
        "question": "Which of the following statements is false about molecular basis of cancer?",
        "options": [
            "Nonlethal genetic damage is central to neoplastic transformation",
            "Almost all tumors represent monoclonal expansion of a single transformed cell",
            "Loss of function mutation involving the growth-promoting proto-oncogenes is usually seen.",
            "Neoplastic transformation is a multistep process"
        ],
        "answer": 2,
        "correctAnswer": "Loss of function mutation involving the growth-promoting proto-oncogenes is usually seen.",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) states that loss-of-function mutations typically involve tumor suppressor genes, not proto-oncogenes, which are gain-of-function mutations, making this statement false.",
        "whyNotOtherOptions": {
            "a": "Genetic damage is central.",
            "b": "Tumors are monoclonal.",
            "d": "Multistep process is true."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 72,
        "question": "What is the most frequently mutated gene in human cancers?",
        "options": [
            "RB",
            "RAS",
            "p53",
            "PTEN"
        ],
        "answer": 2,
        "correctAnswer": "p53",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) identifies p53 as the most commonly mutated gene in human cancers, playing a critical role in cell cycle regulation and apoptosis.",
        "whyNotOtherOptions": {
            "a": "RB is mutated in some cancers.",
            "b": "RAS is common but not most.",
            "d": "PTEN is in some cancers."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 73,
        "question": "Which of the following is not a feature of anaplasia?",
        "options": [
            "Pleomorphism",
            "Hyperchromatism",
            "Increased nuclear to cytoplasmic ratio",
            "Uniformity of cell size and shape"
        ],
        "answer": 3,
        "correctAnswer": "Uniformity of cell size and shape",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) describes anaplasia as characterized by pleomorphism, hyperchromatism, and an increased nuclear-to-cytoplasmic ratio, whereas uniformity of cell size and shape is not a feature, as it indicates differentiation.",
        "whyNotOtherOptions": {
            "a": "Pleomorphism is a feature.",
            "b": "Hyperchromatism is a feature.",
            "c": "Increased N:C ratio is a feature."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 74,
        "question": "A 55-year-old man has experienced increasing abdominal girth for the past 6 months. On physical examination, there is a firm 10-cm mass in the right upper quadrant. Laboratory studies show a serum Î±-fetoprotein (AFP) level of 1200 ng/mL. A biopsy of the mass shows malignant hepatocytes. Which of the following conditions is most likely to have preceded the development of this neoplasm?",
        "options": [
            "Alcoholic cirrhosis",
            "Chronic active hepatitis",
            "Hemochromatosis",
            "All of the above"
        ],
        "answer": 3,
        "correctAnswer": "All of the above",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) associates hepatocellular carcinoma with elevated AFP and identifies alcoholic cirrhosis, chronic active hepatitis, and hemochromatosis as predisposing conditions due to chronic liver damage and inflammation.",
        "whyNotOtherOptions": {
            "a": "True, but all are.",
            "b": "True, but all are.",
            "c": "True, but all are."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 75,
        "question": "A 60-year-old man has noted a change in bowel habits with ribbon-like stools for the past 4 months. On colonoscopy, a 4-cm polypoid mass is seen in the sigmoid colon. A biopsy specimen shows glandular structures with irregular shapes and sizes, and cells with enlarged, hyperchromatic nuclei. Which of the following genes is most likely to show a loss-of-function mutation in this neoplasm?",
        "options": [
            "APC",
            "K-RAS",
            "p53",
            "RB"
        ],
        "answer": 2,
        "correctAnswer": "p53",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) notes that loss-of-function mutations in the p53 gene are common in advanced colorectal cancer, contributing to uncontrolled cell growth as seen in this biopsy with irregular glandular structures.",
        "whyNotOtherOptions": {
            "a": "APC loss is early in polyps.",
            "b": "K-RAS is gain-of-function.",
            "d": "RB is in other cancers."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 76,
        "question": "A 45-year-old woman has noted a lump in her left breast for the past 3 months. On physical examination, there is a 2-cm, firm, mobile mass in the upper outer quadrant. A biopsy shows a well-differentiated neoplasm composed of uniform glands lined by cells resembling normal breast ductal epithelium. Which of the following is the most likely diagnosis?",
        "options": [
            "Ductal carcinoma in situ",
            "Fibroadenoma",
            "Infiltrating ductal carcinoma",
            "Lobular carcinoma"
        ],
        "answer": 1,
        "correctAnswer": "Fibroadenoma",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) describes fibroadenoma as a benign breast tumor with well-differentiated glandular structures resembling normal ductal epithelium, typically presenting as a mobile mass.",
        "whyNotOtherOptions": {
            "a": "DCIS is pre-invasive malignant.",
            "c": "Infiltrating ductal is invasive malignant.",
            "d": "Lobular is malignant."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 77,
        "question": "A 30-year-old man has had a chronic cough with hemoptysis for the past 2 years. A chest radiograph shows a 5-cm mass in the right upper lobe. A biopsy of the mass shows small, round, blue cells with a high nuclear-to-cytoplasmic ratio. Immunohistochemical staining is positive for neuron-specific enolase. Which of the following is the most likely diagnosis?",
        "options": [
            "Adenocarcinoma",
            "Large cell carcinoma",
            "Small cell carcinoma",
            "Squamous cell carcinoma"
        ],
        "answer": 2,
        "correctAnswer": "Small cell carcinoma",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) identifies small cell carcinoma of the lung as characterized by small, round, blue cells with a high nuclear-to-cytoplasmic ratio and positivity for neuron-specific enolase, often associated with chronic cough and hemoptysis.",
        "whyNotOtherOptions": {
            "a": "Adenocarcinoma has glandular formation.",
            "b": "Large cell has large cells.",
            "d": "Squamous has keratin."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 78,
        "question": "Which of the following is a characteristic feature of benign tumors?",
        "options": [
            "Invasion into surrounding tissues",
            "Metastasis to distant sites",
            "Well-defined borders",
            "High mitotic index"
        ],
        "answer": 2,
        "correctAnswer": "Well-defined borders",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) states that benign tumors typically have well-defined borders and do not invade or metastasize, distinguishing them from malignant tumors.",
        "whyNotOtherOptions": {
            "a": "Invasion is malignant.",
            "b": "Metastasis is malignant.",
            "d": "High mitotic index is malignant."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 79,
        "question": "A 50-year-old man presents with weight loss and jaundice. Imaging reveals a mass in the head of the pancreas. A biopsy shows a malignant tumor with glandular differentiation. Which of the following is the most common site of metastasis for this tumor?",
        "options": [
            "Brain",
            "Liver",
            "Lungs",
            "Bones"
        ],
        "answer": 1,
        "correctAnswer": "Liver",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) indicates that pancreatic adenocarcinoma, often arising in the head of the pancreas, most commonly metastasizes to the liver due to its proximity and vascular drainage via the portal vein.",
        "whyNotOtherOptions": {
            "a": "Brain metastasis less common.",
            "c": "Lungs possible but not most common.",
            "d": "Bones possible but not most common."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 80,
        "question": "A 25-year-old woman has a painless swelling in her neck. A biopsy reveals a tumor composed of lymphoid cells with a â€œstarry skyâ€ appearance. Which of the following is the most likely diagnosis?",
        "options": [
            "Hodgkin lymphoma",
            "Non-Hodgkin lymphoma",
            "Burkitt lymphoma",
            "Follicular lymphoma"
        ],
        "answer": 2,
        "correctAnswer": "Burkitt lymphoma",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) describes Burkitt lymphoma as characterized by a â€œstarry skyâ€ appearance due to scattered macrophages among lymphoid cells, often presenting as a painless neck swelling and associated with EBV.",
        "whyNotOtherOptions": {
            "a": "Hodgkin has Reed-Sternberg cells.",
            "b": "Non-Hodgkin is broad.",
            "d": "Follicular has follicular pattern."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 81,
        "question": "Which of the following tumors is most commonly associated with paraneoplastic syndromes?",
        "options": [
            "Renal cell carcinoma",
            "Basal cell carcinoma",
            "Lipoma",
            "Leiomyoma"
        ],
        "answer": 0,
        "correctAnswer": "Renal cell carcinoma",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) notes that renal cell carcinoma is frequently associated with paraneoplastic syndromes, such as hypercalcemia or polycythemia, due to ectopic hormone production.",
        "whyNotOtherOptions": {
            "b": "Basal cell rarely has paraneoplastic.",
            "c": "Lipoma is benign, no paraneoplastic.",
            "d": "Leiomyoma is benign, no paraneoplastic."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 82,
        "question": "A 40-year-old man has a history of smoking and presents with a persistent cough. A chest CT shows a 3-cm mass in the lung. A biopsy reveals a tumor with keratin pearl formation. Which of the following is the most likely diagnosis?",
        "options": [
            "Adenocarcinoma",
            "Small cell carcinoma",
            "Squamous cell carcinoma",
            "Large cell carcinoma"
        ],
        "answer": 2,
        "correctAnswer": "Squamous cell carcinoma",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) identifies squamous cell carcinoma of the lung as characterized by keratin pearl formation, often linked to smoking and presenting with a persistent cough.",
        "whyNotOtherOptions": {
            "a": "Adenocarcinoma has glands.",
            "b": "Small cell has small cells.",
            "d": "Large cell has undifferentiated large cells."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 83,
        "question": "Which of the following is a tumor marker for ovarian cancer?",
        "options": [
            "AFP",
            "CA-125",
            "CEA",
            "PSA"
        ],
        "answer": 1,
        "correctAnswer": "CA-125",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) lists CA-125 as a tumor marker commonly elevated in ovarian cancer, particularly epithelial types, aiding in diagnosis and monitoring.",
        "whyNotOtherOptions": {
            "a": "AFP for germ cell or liver.",
            "c": "CEA for colorectal.",
            "d": "PSA for prostate."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 84,
        "question": "A 60-year-old man has a history of heavy alcohol use and presents with abdominal pain and a palpable mass. Imaging shows a large liver mass. A biopsy reveals a tumor with trabecular patterns and bile production. Which of the following is the most likely diagnosis?",
        "options": [
            "Cholangiocarcinoma",
            "Hepatoblastoma",
            "Hepatocellular carcinoma",
            "Metastatic carcinoma"
        ],
        "answer": 2,
        "correctAnswer": "Hepatocellular carcinoma",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) describes hepatocellular carcinoma as a tumor with trabecular patterns and bile production, often associated with chronic alcohol use and liver cirrhosis.",
        "whyNotOtherOptions": {
            "a": "Cholangiocarcinoma from bile ducts.",
            "b": "Hepatoblastoma in children.",
            "d": "Metastatic lacks bile production."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 85,
        "question": "Which of the following is a feature of tumor angiogenesis?",
        "options": [
            "Decreased vascular permeability",
            "Formation of new blood vessels",
            "Reduced expression of VEGF",
            "Apoptosis of endothelial cells"
        ],
        "answer": 1,
        "correctAnswer": "Formation of new blood vessels",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) explains that tumor angiogenesis involves the formation of new blood vessels to supply the growing tumor, driven by factors like VEGF.",
        "whyNotOtherOptions": {
            "a": "Increased permeability in tumor vessels.",
            "c": "Increased VEGF expression.",
            "d": "Proliferation, not apoptosis of endothelia."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 86,
        "question": "A 35-year-old woman has a family history of breast cancer and undergoes genetic testing. She is found to have a mutation in the BRCA2 gene. Which of the following cancers is she at increased risk for?",
        "options": [
            "Colon cancer",
            "Ovarian cancer",
            "Prostate cancer",
            "Both B and C"
        ],
        "answer": 3,
        "correctAnswer": "Both B and C",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) associates BRCA2 mutations with an increased risk of ovarian and prostate cancers, in addition to breast cancer, due to impaired DNA repair.",
        "whyNotOtherOptions": {
            "a": "Not associated with BRCA2.",
            "b": "True, but also C.",
            "c": "True, but also B."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    },
    {
        "id": 87,
        "question": "Which of the following is not a characteristic of cancer stem cells?",
        "options": [
            "Self-renewal capacity",
            "Differentiation potential",
            "Resistance to chemotherapy",
            "High metabolic rate"
        ],
        "answer": 3,
        "correctAnswer": "High metabolic rate",
        "explanation": "Robbins Basic Pathology (Chapter 7: Neoplasia) describes cancer stem cells as having self-renewal capacity, differentiation potential, and resistance to chemotherapy, but a high metabolic rate is not a defining characteristic.",
        "whyNotOtherOptions": {
            "a": "Self-renewal is key.",
            "b": "Differentiation is key.",
            "c": "Chemoresistance is feature."
        },
        "relatedQuestions": [],
        "category": "Neoplasia",
        "difficulty": "Medium"
    }
];

// Core application variables
const overlay = document.getElementById('overlay');
const menuToggle = document.getElementById('menuToggle');
const sidebar = document.getElementById('sidebar');
const mainContent = document.getElementById('mainContent');
const categoriesGrid = document.getElementById('categoriesGrid');
const themeToggle = document.getElementById('themeToggle');
const quizContainer = document.getElementById('quizContainer');
const resultsScreen = document.getElementById('resultsScreen');
const pageTitle = document.getElementById('pageTitle');
const modeButtons = document.querySelectorAll('.mode-btn');
const correctAnswersEl = document.getElementById('correctAnswers');
const timeSpentEl = document.getElementById('timeSpent');
const masteryLevelEl = document.getElementById('masteryLevel');
const streakCountEl = document.getElementById('streakCount');
const searchInput = document.getElementById('searchInput');
const exportProgressBtn = document.getElementById('exportProgress');
const createCustomQuizBtn = document.getElementById('createCustomQuizBtn');
const customQuizModal = document.getElementById('customQuizModal');
const cancelCustomQuizBtn = document.getElementById('cancelCustomQuiz');
const createCustomQuizBtnModal = document.getElementById('createCustomQuiz');
const weakAreasCountEl = document.getElementById('weakAreasCount');
const avgTimePerQuestionEl = document.getElementById('avgTimePerQuestion');
const improvementRateEl = document.getElementById('improvementRate');

// Navigation elements
const navItems = document.querySelectorAll('.nav-item');

// Application state
let currentMode = 'exam';
let selectedCategories = [];
let currentQuestionIndex = 0;
let score = 0;
let userAnswers = [];
let questions = [];
let incorrectQuestions = [];
let isAnswerChecked = false;
let bookmarkedQuestions = new Set();
let userProgress = {};
let userStats = {
    totalQuestions: 0,
    correctAnswers: 0,
    timeSpent: 0,
    masteryLevel: 0,
    streak: 0,
    lastActive: null,
    weeklyProgress: []
};
let timerInterval = null;
let startTime = null;
let remainingTime = 0;
let isCountdown = false;
let examCheckMode = 'immediate';
let examSubmitted = false;
let questionTimers = [];
let searchResults = [];
let isSearchActive = false;
let currentPage = 'dashboard';
let customQuestions = [];

// Core application functions
function init() {
    initializeCategories();
    initializeEventListeners();
    initializeNavigation();
    loadUserData();
    updateDashboardStats();
    updateAnalytics();
    showDashboard();
    createFAB();
    updateCustomQuizModalHTML();
}

function createFAB() {
    const fab = document.createElement('button');
    fab.className = 'fab';
    fab.innerHTML = '<i class="fas fa-plus"></i>';
    fab.title = 'Create Custom Question';
    fab.addEventListener('click', showCustomQuestionCreator);
    document.body.appendChild(fab);
}

function initializeNavigation() {
    navItems.forEach((item, index) => {
        item.addEventListener('click', () => {
            navItems.forEach(nav => nav.classList.remove('active'));
            item.classList.add('active');
            
            switch(index) {
                case 0: // Dashboard
                    currentPage = 'dashboard';
                    showDashboard();
                    break;
                case 1: // My Courses
                    currentPage = 'courses';
                    showCourses();
                    break;
                case 2: // Progress Analytics
                    currentPage = 'analytics';
                    showAnalytics();
                    break;
                case 3: // Bookmarked Questions
                    currentPage = 'bookmarks';
                    showBookmarks();
                    break;
                case 4: // Settings
                    currentPage = 'settings';
                    showSettings();
                    break;
            }
            
            closeSidebar();
        });
    });
}

function showDashboard() {
    hideAllSections();
    document.querySelector('.stats-grid').style.display = 'grid';
    document.querySelector('.analytics-section').style.display = 'block';
    document.querySelector('.search-container').style.display = 'block';
    document.querySelector('.export-section').style.display = 'block';
    
    // Reset page title
    pageTitle.textContent = 'Medical Quiz Dashboard';
    updateDashboardStats();
    
    // Only show all questions if not in search mode
    if (!isSearchActive) {
        questions = [...quizData, ...customQuestions];
        selectedCategories = [...new Set(questions.map(q => q.category))];
        renderQuizLayout();
    } else {
        // If we're in search mode, show the search results
        performSearch(searchInput.value.trim().toLowerCase());
    }
}

function showCourses() {
    hideAllSections();
    pageTitle.textContent = 'My Courses';
    
    quizContainer.innerHTML = `
        <div style="text-align: center; padding: 40px 20px;">
            <div style="font-size: 80px; color: var(--primary); margin-bottom: 20px; opacity: 0.8;">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <h2 style="font-size: 32px; margin-bottom: 16px; color: var(--text-primary); background: linear-gradient(135deg, var(--primary), var(--primary-dark)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700;">Learning Pathways</h2>
            <p style="color: var(--text-secondary); margin-bottom: 40px; max-width: 500px; margin-left: auto; margin-right: auto; font-size: 16px; line-height: 1.6;">
                Structured learning paths designed to build your medical knowledge systematically.
            </p>
           <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 24px; margin-top: 40px;">
                    <div onclick="window.location.href='anatomy.html'" style="cursor: pointer;">
                       ${createCourseCard('Anatomy Mastery', 'fas fa-brain', '#6366f1', 75, 'Build foundational anatomy knowledge')}
                    </div>
  <div onclick="window.location.href='anatomy.html'" style="cursor: pointer;">
                       ${createCourseCard('Physiology Deep Dive', 'fas fa-heartbeat', '#06b6d4', 45, 'Understand body systems and functions')}
                   </div>
  <div onclick="window.location.href='anatomy.html'" style="cursor: pointer;">
                       ${createCourseCard('Clinical Pathology', 'fas fa-virus', '#10b981', 30, 'Study diseases and diagnostics')}
                    </div> 
  <div onclick="window.location.href='anatomy.html'" style="cursor: pointer;">
                       ${createCourseCard('Pharmacology', 'fas fa-pills', '#f59e0b', 20, 'Master drug mechanisms and effects')}
                    </div>
    <div onclick="window.location.href='anatomy.html'" style="cursor: pointer;">
                       ${createCourseCard('Medical Imaging', 'fas fa-x-ray', '#8b5cf6', 15, 'Learn radiology and imaging techniques')}
                    </div>
    <div onclick="window.location.href='anatomy.html'" style="cursor: pointer;">
                       ${createCourseCard('Emergency Medicine', 'fas fa-ambulance', '#ef4444', 10, 'Critical care and emergency procedures')}
                    </div>
            </div>
        </div>
    `;
    quizContainer.classList.remove('hidden');
}

function createCourseCard(title, icon, color, progress, description) {
    return `
        <div class="category-card" style="text-align: left; cursor: pointer; border-left: 4px solid ${color};" onclick="startCourse('${title.toLowerCase()}')">
            <div class="category-header">
                <div class="category-icon" style="background: ${color}20; color: ${color};">
                    <i class="${icon}"></i>
                </div>
                <div>
                    <div class="category-name" style="font-size: 16px; font-weight: 600;">${title}</div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">${description}</div>
                </div>
            </div>
            <div class="category-stats">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${progress}%; background: ${color}"></div>
                </div>
                <div class="progress-text">${progress}%</div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 12px;">
                <span style="font-size: 11px; color: var(--text-tertiary);">${Math.floor(progress/10)}/10 Modules</span>
                <span style="font-size: 11px; color: ${color}; font-weight: 600;">Continue â†’</span>
            </div>
        </div>
    `;
}

function showAnalytics() {
    hideAllSections();
    document.querySelector('.stats-grid').style.display = 'grid';
    document.querySelector('.analytics-section').style.display = 'block';
    document.querySelector('.export-section').style.display = 'block';
    pageTitle.textContent = 'Progress Analytics';
    updateAnalytics();
    
    quizContainer.innerHTML = `
        <div style="padding: 24px;">
            <div class="analytics-section glass-effect" style="border-radius: 24px; padding: 32px;">
                <h3 class="analytics-title" style="font-size: 24px; margin-bottom: 8px;">Performance Insights</h3>
                <p style="color: var(--text-secondary); margin-bottom: 32px;">Detailed analytics to optimize your learning journey</p>
                <div class="analytics-grid">
                    <div class="analytics-card glass-effect" style="border-radius: 20px; padding: 24px;">
                        <div class="analytics-value" style="font-size: 32px; color: var(--primary);">${weakAreasCountEl.textContent}</div>
                        <div class="analytics-label">Areas Needing Focus</div>
                    </div>
                    <div class="analytics-card glass-effect" style="border-radius: 20px; padding: 24px;">
                        <div class="analytics-value" style="font-size: 32px; color: #06b6d4;">${avgTimePerQuestionEl.textContent}</div>
                        <div class="analytics-label">Average Response Time</div>
                    </div>
                    <div class="analytics-card glass-effect" style="border-radius: 20px; padding: 24px;">
                        <div class="analytics-value" style="font-size: 32px; color: #10b981;">${improvementRateEl.textContent}</div>
                        <div class="analytics-label">Weekly Progress Rate</div>
                    </div>
                </div>
            </div>
            
            <div class="glass-effect" style="border-radius: 24px; padding: 32px; margin-top: 24px; border: 1px solid rgba(255, 255, 255, 0.2);">
                <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 24px; color: var(--text-primary);">ðŸ“Š Learning Recommendations</h3>
                <div style="display: grid; gap: 16px;">
                    ${createRecommendation('Focus on Weak Areas', 'fas fa-bullseye', 'var(--primary)', 'Spend 60% of study time on topics below 70% mastery')}
                    ${createRecommendation('Consistent Practice', 'fas fa-chart-line', '#10b981', `Maintain your ${userStats.streak}-day streak for optimal retention`)}
                    ${createRecommendation('Active Recall', 'fas fa-brain', '#8b5cf6', 'Use spaced repetition for better long-term memory')}
                    ${createRecommendation('Mixed Practice', 'fas fa-random', '#f59e0b', 'Combine different topics in single study sessions')}
                </div>
            </div>

            <div class="glass-effect" style="border-radius: 24px; padding: 32px; margin-top: 24px; border: 1px solid rgba(255, 255, 255, 0.2);">
                <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 24px; color: var(--text-primary);">ðŸŽ¯ Study Plan</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    ${createStudyPlanItem('Daily Goal', '50 questions', 'fas fa-calendar-day', '#6366f1')}
                    ${createStudyPlanItem('Weekly Target', '5 hours', 'fas fa-chart-bar', '#06b6d4')}
                    ${createStudyPlanItem('Mastery Goal', '85% overall', 'fas fa-trophy', '#f59e0b')}
                    ${createStudyPlanItem('Weak Topics', '2 sessions/week', 'fas fa-exclamation-triangle', '#ef4444')}
                </div>
            </div>
        </div>
    `;
    quizContainer.classList.remove('hidden');
}

function createRecommendation(title, icon, color, description) {
    return `
        <div style="display: flex; align-items: center; gap: 16px; padding: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 16px; border-left: 4px solid ${color};">
            <i class="${icon}" style="color: ${color}; font-size: 24px;"></i>
            <div>
                <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 4px;">${title}</div>
                <div style="font-size: 14px; color: var(--text-secondary); line-height: 1.5;">${description}</div>
            </div>
        </div>
    `;
}

function createStudyPlanItem(title, value, icon, color) {
    return `
        <div style="text-align: center; padding: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 16px;">
            <i class="${icon}" style="color: ${color}; font-size: 32px; margin-bottom: 12px;"></i>
            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">${title}</div>
            <div style="font-size: 18px; color: ${color}; font-weight: 700;">${value}</div>
        </div>
    `;
}

function showBookmarks() {
    const bookmarkedQuestionsList = [...quizData, ...customQuestions].filter(q => bookmarkedQuestions.has(q.id));
    hideAllSections();
    pageTitle.textContent = 'Bookmarked Questions';
    
    if (bookmarkedQuestionsList.length === 0) {
        quizContainer.innerHTML = `
            <div style="text-align: center; padding: 80px 20px;">
                <div style="font-size: 96px; color: var(--text-tertiary); margin-bottom: 24px; opacity: 0.5;">
                    <i class="far fa-bookmark"></i>
                </div>
                <h2 style="font-size: 32px; margin-bottom: 16px; color: var(--text-primary);">No Bookmarked Questions Yet</h2>
                <p style="color: var(--text-secondary); margin-bottom: 40px; max-width: 400px; margin-left: auto; margin-right: auto; font-size: 16px; line-height: 1.6;">
                    Click the bookmark icon on any question to save it here for quick review. This is perfect for difficult concepts or important topics you want to revisit.
                </p>
                <button class="quiz-btn" onclick="showDashboard(); navItems[0].click()" style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 16px 32px; border-radius: 16px;">
                    <i class="fas fa-arrow-left"></i>
                    Explore Questions
                </button>
            </div>
        `;
    } else {
        quizContainer.innerHTML = `
            <div style="padding: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
                    <div>
                        <h2 style="font-size: 28px; font-weight: 700; color: var(--text-primary); margin-bottom: 8px;">
                            ${bookmarkedQuestionsList.length} Saved Question${bookmarkedQuestionsList.length !== 1 ? 's' : ''}
                        </h2>
                        <p style="color: var(--text-secondary);">Your personal collection of important questions</p>
                    </div>
                    <button class="quiz-btn" onclick="startBookmarksQuiz()" style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 16px 24px; border-radius: 16px;">
                        <i class="fas fa-play"></i>
                        Practice Bookmarks
                    </button>
                </div>
                <div style="display: grid; gap: 20px;">
                    ${bookmarkedQuestionsList.map(question => `
                        <div class="question-card glass-effect" style="cursor: pointer; border-radius: 20px; padding: 24px;" onclick="jumpToBookmarkQuestion(${question.id})">
                            <div class="question-header">
                                <div class="question-meta">
                                    <div class="question-number" style="background: linear-gradient(135deg, var(--primary), var(--primary-dark));">Q${question.id}</div>
                                    <div class="question-category glass-effect">${question.category}</div>
                                    <div class="question-difficulty" style="background: ${getDifficultyColor(question.difficulty)};">
                                        ${question.difficulty}
                                    </div>
                                    ${question.custom ? '<div class="question-category glass-effect" style="background: #10b98120; color: #10b981;">Custom</div>' : ''}
                                </div>
                                <div class="question-actions">
                                    <button class="action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(${question.id}); showBookmarks();" aria-label="Remove Bookmark" style="background: rgba(239, 68, 68, 0.1); color: var(--error);">
                                        <i class="fas fa-bookmark"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="question-text" style="font-size: 16px; line-height: 1.6;">${question.question}</div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }
    quizContainer.classList.remove('hidden');
}

// Add this function to handle clicking on individual bookmark questions
function jumpToBookmarkQuestion(questionId) {
    const bookmarkedQuestionsList = [...quizData, ...customQuestions].filter(q => bookmarkedQuestions.has(q.id));
    
    // Start a quiz with just this one question
    questions = [bookmarkedQuestionsList.find(q => q.id === questionId)];
    currentQuestionIndex = 0;
    userAnswers = new Array(questions.length);
    isAnswerChecked = false;
    currentMode = 'quiz';
    
    // Update mode buttons
    modeButtons.forEach(b => b.classList.remove('active'));
    modeButtons[1].classList.add('active'); // Quiz mode
    
    pageTitle.textContent = 'Quiz Mode - Bookmarked Question';
    
    hideAllSections();
    quizContainer.classList.remove('hidden');
    renderQuizLayout();
}

function showSettings() {
    hideAllSections();
    pageTitle.textContent = 'Settings & Preferences';
    
    quizContainer.innerHTML = `
        <div style="padding: 24px; max-width: 800px; margin: 0 auto;">
            <div class="settings-panel" style="padding: 32px; margin-bottom: 24px;">
                <h3 style="font-size: 24px; font-weight: 700; margin-bottom: 8px; color: var(--text-primary);">ðŸŽ¨ Appearance</h3>
                <p style="color: var(--text-secondary); margin-bottom: 24px;">Customize the look and feel of your study environment</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div>
                        <label style="display: block; color: var(--text-secondary); margin-bottom: 12px; font-weight: 600;">Theme</label>
                        <div class="mode-selector glass-effect" style="padding: 8px; border-radius: 16px;">
                            <button class="mode-btn ${document.body.classList.contains('dark-mode') ? '' : 'active'}" onclick="setTheme('light')" style="border-radius: 12px; padding: 12px 16px;">
                                <i class="fas fa-sun"></i>
                                Light Mode
                            </button>
                            <button class="mode-btn ${document.body.classList.contains('dark-mode') ? 'active' : ''}" onclick="setTheme('dark')" style="border-radius: 12px; padding: 12px 16px;">
                                <i class="fas fa-moon"></i>
                                Dark Mode
                            </button>
                        </div>
                    </div>
                    <div>
                        <label style="display: block; color: var(--text-secondary); margin-bottom: 12px; font-weight: 600;">Animation</label>
                        <div class="mode-selector glass-effect" style="padding: 8px; border-radius: 16px;">
                            <button class="mode-btn active" style="border-radius: 12px; padding: 12px 16px;">
                                <i class="fas fa-bolt"></i>
                                Smooth
                            </button>
                            <button class="mode-btn" style="border-radius: 12px; padding: 12px 16px;">
                                <i class="fas fa-minus"></i>
                                Minimal
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="settings-panel" style="padding: 32px; margin-bottom: 24px;">
                <h3 style="font-size: 24px; font-weight: 700; margin-bottom: 8px; color: var(--text-primary);">âš¡ Study Preferences</h3>
                <p style="color: var(--text-secondary); margin-bottom: 24px;">Optimize your learning experience</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div>
                        <label style="display: block; color: var(--text-secondary); margin-bottom: 12px; font-weight: 600;">Default Mode</label>
                        <div class="mode-selector glass-effect" style="padding: 8px; border-radius: 16px;">
                            <button class="mode-btn ${currentMode === 'quiz' ? 'active' : ''}" onclick="setDefaultMode('quiz')" style="border-radius: 12px; padding: 12px 16px;">
                                <i class="fas fa-tasks"></i>
                                Quiz
                            </button>
                            <button class="mode-btn ${currentMode === 'exam' ? 'active' : ''}" onclick="setDefaultMode('exam')" style="border-radius: 12px; padding: 12px 16px;">
                                <i class="fas fa-file-alt"></i>
                                Exam
                            </button>
                        </div>
                    </div>
                    <div>
                        <label style="display: block; color: var(--text-secondary); margin-bottom: 12px; font-weight: 600;">Questions Per Session</label>
                        <select class="modern-dropdown" style="width: 100%;" onchange="setQuestionsPerSession(this.value)">
                            <option value="10">10 Questions</option>
                            <option value="25" selected>25 Questions</option>
                            <option value="50">50 Questions</option>
                            <option value="100">100 Questions</option>
                            <option value="0">All Questions</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="settings-panel" style="padding: 32px; margin-bottom: 24px;">
                <h3 style="font-size: 24px; font-weight: 700; margin-bottom: 8px; color: var(--text-primary);">ðŸ“Š Data & Progress</h3>
                <p style="color: var(--text-secondary); margin-bottom: 24px;">Manage your learning data</p>
                <div style="display: flex; flex-direction: column; gap: 16px;">
                    <button class="quiz-btn" onclick="exportProgress()" style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 16px 24px; border-radius: 16px; justify-content: start;">
                        <i class="fas fa-download" style="margin-right: 12px;"></i>
                        Export Progress Data
                    </button>
                    <button class="quiz-btn" onclick="showCustomQuestionCreator()" style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 16px 24px; border-radius: 16px; justify-content: start;">
                        <i class="fas fa-plus" style="margin-right: 12px;"></i>
                        Create Custom Question
                    </button>
                    <button class="quiz-btn" onclick="resetProgress()" style="background: linear-gradient(135deg, var(--error), #dc2626); color: white; padding: 16px 24px; border-radius: 16px; justify-content: start;">
                        <i class="fas fa-trash" style="margin-right: 12px;"></i>
                        Reset All Progress
                    </button>
                </div>
            </div>

            <div class="settings-panel" style="padding: 32px;">
                <h3 style="font-size: 24px; font-weight: 700; margin-bottom: 8px; color: var(--text-primary);">â„¹ï¸ About MediQuiz Pro</h3>
                <div style="color: var(--text-secondary); line-height: 1.7;">
                    <p>MediQuiz Pro is an advanced medical education platform designed to help medical students and professionals enhance their knowledge through interactive quizzes and detailed analytics.</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 20px;">
                        <div>
                            <strong style="color: var(--text-primary);">Version</strong>
                            <div>2.1.0</div>
                        </div>
                        <div>
                            <strong style="color: var(--text-primary);">Questions</strong>
                            <div>${quizData.length + customQuestions.length} total</div>
                        </div>
                        <div>
                            <strong style="color: var(--text-primary);">Last Updated</strong>
                            <div>${new Date().toLocaleDateString()}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    quizContainer.classList.remove('hidden');
}

function setTheme(theme) {
    if (theme === 'dark') {
        document.body.classList.add('dark-mode');
        themeToggle.querySelector('i').className = 'fas fa-sun';
    } else {
        document.body.classList.remove('dark-mode');
        themeToggle.querySelector('i').className = 'fas fa-moon';
    }
    showNotification(`Theme set to ${theme} mode`, 'success');
}

function setDefaultMode(mode) {
    currentMode = mode;
    modeButtons.forEach(b => b.classList.remove('active'));
    modeButtons[mode === 'quiz' ? 1 : 0].classList.add('active');
    showNotification(`Default mode set to ${mode}`, 'success');
}

function setQuestionsPerSession(count) {
    showNotification(`Questions per session set to ${count === '0' ? 'all' : count}`, 'info');
}

function showCustomQuestionCreator() {
    const modal = document.createElement('div');
    modal.className = 'custom-quiz-modal active';
    modal.innerHTML = `
        <div class="custom-quiz-content glass-effect" style="max-width: 600px; border-radius: 24px;">
            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 24px;">
                <h3 style="font-size: 24px; font-weight: 700; color: var(--text-primary);">Create Custom Question</h3>
                <button class="action-btn" onclick="closeCustomQuestionModal()" style="background: rgba(239, 68, 68, 0.1); color: var(--error);">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="custom-question-creator">
                <div style="display: grid; gap: 20px;">
                    <div>
                        <label style="display: block; color: var(--text-secondary); margin-bottom: 8px; font-weight: 600;">Question Text</label>
                        <textarea id="customQuestionText" placeholder="Enter your question here..." style="width: 100%; padding: 16px; border: 2px solid var(--border); border-radius: 16px; background: var(--surface); color: var(--text-primary); font-size: 14px; resize: vertical; min-height: 80px;"></textarea>
                    </div>
                    
                    <div>
                        <label style="display: block; color: var(--text-secondary); margin-bottom: 8px; font-weight: 600;">Category</label>
                        <select id="customQuestionCategory" class="modern-dropdown" style="width: 100%;">
                            <option value="Custom Anatomy">Custom Anatomy</option>
                            <option value="Custom Physiology">Custom Physiology</option>
                            <option value="Custom Pathology">Custom Pathology</option>
                            <option value="Custom Pharmacology">Custom Pharmacology</option>
                            <option value="General Medicine">General Medicine</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="display: block; color: var(--text-secondary); margin-bottom: 8px; font-weight: 600;">Difficulty</label>
                        <div class="mode-selector glass-effect" style="padding: 8px; border-radius: 16px;">
                            <button type="button" class="mode-btn difficulty-btn active" data-difficulty="Easy" style="border-radius: 12px; padding: 12px 16px;">
                                Easy
                            </button>
                            <button type="button" class="mode-btn difficulty-btn" data-difficulty="Medium" style="border-radius: 12px; padding: 12px 16px;">
                                Medium
                            </button>
                            <button type="button" class="mode-btn difficulty-btn" data-difficulty="Hard" style="border-radius: 12px; padding: 12px 16px;">
                                Hard
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label style="display: block; color: var(--text-secondary); margin-bottom: 12px; font-weight: 600;">Options</label>
                        <div style="display: grid; gap: 12px;">
                            ${['A', 'B', 'C', 'D'].map(letter => `
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--surface); display: flex; align-items: center; justify-content: center; font-weight: 600; color: var(--text-secondary); flex-shrink: 0;">${letter}</div>
                                    <input type="text" id="customOption${letter}" placeholder="Option ${letter}" style="flex: 1; padding: 12px 16px; border: 2px solid var(--border); border-radius: 12px; background: var(--surface); color: var(--text-primary);">
                                    <input type="radio" name="correctAnswer" value="${letter}" id="correct${letter}" style="transform: scale(1.2);">
                                    <label for="correct${letter}" style="color: var(--text-secondary); font-weight: 600;">Correct</label>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div>
                        <label style="display: block; color: var(--text-secondary); margin-bottom: 8px; font-weight: 600;">Explanation</label>
                        <textarea id="customExplanation" placeholder="Explain why the correct answer is right..." style="width: 100%; padding: 16px; border: 2px solid var(--border); border-radius: 16px; background: var(--surface); color: var(--text-primary); font-size: 14px; resize: vertical; min-height: 60px;"></textarea>
                    </div>
                </div>
                
                <div class="custom-quiz-actions" style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 32px;">
                    <button class="quiz-btn" onclick="closeCustomQuestionModal()" style="background: var(--secondary); color: white; padding: 12px 24px; border-radius: 12px;">
                        Cancel
                    </button>
                    <button class="quiz-btn check-btn" onclick="saveCustomQuestion()" style="padding: 12px 24px; border-radius: 12px;">
                        <i class="fas fa-save"></i>
                        Save Question
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Add difficulty button handlers
    modal.querySelectorAll('.difficulty-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            modal.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
        });
    });
}

function closeCustomQuestionModal() {
    const modal = document.querySelector('.custom-quiz-modal');
    if (modal) {
        modal.remove();
    }
}

function saveCustomQuestion() {
    const questionText = document.getElementById('customQuestionText').value;
    const category = document.getElementById('customQuestionCategory').value;
    const difficulty = document.querySelector('.difficulty-btn.active').dataset.difficulty;
    const explanation = document.getElementById('customExplanation').value;
    
    // Get options
    const options = [];
    for (let letter of ['A', 'B', 'C', 'D']) {
        const optionText = document.getElementById(`customOption${letter}`).value;
        if (optionText.trim()) {
            options.push(optionText);
        }
    }
    
    // Get correct answer
    const correctAnswerRadio = document.querySelector('input[name="correctAnswer"]:checked');
    if (!correctAnswerRadio) {
        showNotification('Please select the correct answer', 'error');
        return;
    }
    
    const correctAnswerIndex = ['A', 'B', 'C', 'D'].indexOf(correctAnswerRadio.value);
    
    if (!questionText.trim() || options.length < 2) {
        showNotification('Please fill in all required fields', 'error');
        return;
    }
    
    // Generate a unique ID for the custom question
    const maxId = Math.max(
        ...quizData.map(q => q.id),
        ...customQuestions.map(q => q.id),
        0
    );
    
    const newQuestion = {
        id: maxId + 1,
        question: questionText,
        options: options,
        answer: correctAnswerIndex,
        correctAnswer: options[correctAnswerIndex],
        explanation: explanation || 'No explanation provided.',
        whyNotOtherOptions: {},
        relatedQuestions: [],
        category: category,
        difficulty: difficulty,
        custom: true
    };
    
    customQuestions.push(newQuestion);
    saveUserData();
    
    closeCustomQuestionModal();
    showNotification('Custom question created successfully!', 'success');
    
    // Refresh the current view and categories
    initializeCategories();
    if (currentPage === 'dashboard') {
        showDashboard();
    } else if (currentPage === 'bookmarks') {
        showBookmarks();
    }
}

function hideAllSections() {
    quizContainer.classList.add('hidden');
    resultsScreen.classList.add('hidden');
    document.querySelector('.stats-grid').style.display = 'none';
    document.querySelector('.analytics-section').style.display = 'none';
    document.querySelector('.export-section').style.display = 'none';
    // Note: search-container is NOT hidden here - we want it always visible during search
}

function startCourse(courseName) {
    showNotification(`Starting ${courseName} course...`, 'info');
    // Filter questions by course/category and start quiz
    const courseQuestions = [...quizData, ...customQuestions].filter(q => 
        q.category.toLowerCase().includes(courseName.toLowerCase())
    );
    
    if (courseQuestions.length === 0) {
        showNotification('No questions available for this course yet', 'info');
        return;
    }
    
    questions = courseQuestions;
    currentQuestionIndex = 0;
    userAnswers = new Array(questions.length);
    isAnswerChecked = false;
    currentMode = 'quiz';
    modeButtons.forEach(b => b.classList.remove('active'));
    modeButtons[1].classList.add('active');
    pageTitle.textContent = `Quiz Mode - ${courseName}`;
    
    hideAllSections();
    renderQuizLayout();
}

// FIXED BOOKMARK PRACTICE FUNCTION
function startBookmarksQuiz() {
    const bookmarkedQuestionsList = [...quizData, ...customQuestions].filter(q => bookmarkedQuestions.has(q.id));
    
    if (bookmarkedQuestionsList.length === 0) {
        showNotification('No bookmarked questions to practice!', 'error');
        return;
    }
    
    questions = bookmarkedQuestionsList;
    currentQuestionIndex = 0;
    userAnswers = new Array(questions.length);
    isAnswerChecked = false;
    currentMode = 'quiz';
    
    // Update mode buttons
    modeButtons.forEach(b => b.classList.remove('active'));
    modeButtons[1].classList.add('active'); // Quiz mode
    
    pageTitle.textContent = 'Quiz Mode - Bookmarked Questions';
    
    hideAllSections();
    quizContainer.classList.remove('hidden');
    renderQuizLayout();
    
    showNotification(`Starting practice with ${questions.length} bookmarked questions`, 'success');
}

function resetProgress() {
    if (confirm('Are you sure you want to reset all your progress? This action cannot be undone.')) {
        userProgress = {};
        userStats = {
            totalQuestions: 0,
            correctAnswers: 0,
            timeSpent: 0,
            masteryLevel: 0,
            streak: 0,
            lastActive: new Date().toISOString(),
            weeklyProgress: []
        };
        bookmarkedQuestions = new Set();
        customQuestions = [];
        saveUserData();
        updateDashboardStats();
        updateAnalytics();
        showNotification('All progress has been reset', 'success');
        showDashboard();
    }
}

function initializeEventListeners() {
    menuToggle.addEventListener('click', toggleSidebar);
    overlay.addEventListener('click', closeSidebar);
    themeToggle.addEventListener('click', toggleTheme);
    
    modeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            modeButtons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentMode = btn.dataset.mode;
            pageTitle.textContent = `${btn.dataset.mode.charAt(0).toUpperCase() + btn.dataset.mode.slice(1)} Mode`;
            startQuiz();
        });
    });
    
    initializeEnhancedFeatures();
}

function toggleSidebar() {
    sidebar.classList.toggle('open');
    overlay.classList.toggle('active');
    mainContent.classList.toggle('sidebar-open');
    document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : '';
}

function closeSidebar() {
    sidebar.classList.remove('open');
    overlay.classList.remove('active');
    mainContent.classList.remove('sidebar-open');
    document.body.style.overflow = '';
}

function toggleTheme() {
    document.body.classList.toggle('dark-mode');
    const icon = themeToggle.querySelector('i');
    if (document.body.classList.contains('dark-mode')) {
        icon.className = 'fas fa-sun';
    } else {
        icon.className = 'fas fa-moon';
    }
}

function initializeEnhancedFeatures() {
    initializeSearch();
    initializeKeyboardNavigation();
    enhanceAccessibility();
    
    exportProgressBtn.addEventListener('click', exportProgress);
    createCustomQuizBtn.addEventListener('click', () => {
        customQuizModal.classList.add('active');
    });
    cancelCustomQuizBtn.addEventListener('click', () => {
        customQuizModal.classList.remove('active');
    });
    createCustomQuizBtnModal.addEventListener('click', () => {
        const selectedOptions = document.querySelectorAll('.custom-quiz-option.selected');
        const options = {
            categories: selectedCategories,
            difficulty: null,
            bookmarkedOnly: false
        };
        
        selectedOptions.forEach(option => {
            const category = option.dataset.category;
            if (category === 'easy' || category === 'medium' || category === 'hard') {
                options.difficulty = category;
            } else if (category === 'bookmarked') {
                options.bookmarkedOnly = true;
            }
        });
        
        createCustomQuiz(options);
    });
    
    // Add selection toggling for custom quiz options
    document.addEventListener('click', (e) => {
        if (e.target.closest('.custom-quiz-option')) {
            const option = e.target.closest('.custom-quiz-option');
            option.classList.toggle('selected');
        }
    });
    
    // Ensure search works when clicking dashboard
    navItems[0].addEventListener('click', () => {
        if (searchInput.value.trim().length > 0) {
            // If there's a search query, maintain search state
            isSearchActive = true;
        }
    });
}

// FIXED SEARCH FUNCTIONALITY
function initializeSearch() {
    if (searchInput) {
        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.trim().toLowerCase();
            
            // Clear previous search state when input is empty
            if (query.length === 0) {
                document.body.classList.remove('search-blur-active');
                isSearchActive = false;
                if (currentPage === 'dashboard') {
                    showDashboard();
                }
                return;
            }
            
            // Add blur effect when searching
            document.body.classList.add('search-blur-active');
            
            if (query.length < 2) {
                isSearchActive = false;
                return;
            }
            
            isSearchActive = true;
            performSearch(query);
        });
        
        // Add clear search functionality
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                clearSearch();
            }
        });
    }
}

function performSearch(query) {
    const allQuestions = [...quizData, ...customQuestions];
    searchResults = allQuestions.filter(q => 
        q.question.toLowerCase().includes(query) ||
        q.category.toLowerCase().includes(query) ||
        (q.explanation && q.explanation.toLowerCase().includes(query)) ||
        q.options.some(opt => opt.toLowerCase().includes(query))
    );
    
    console.log('Search query:', query, 'Results:', searchResults.length); // Debug log
    
    if (searchResults.length > 0) {
        // Show search results in quiz layout
        questions = searchResults;
        currentQuestionIndex = 0;
        userAnswers = new Array(questions.length);
        isAnswerChecked = false;
        
        hideAllSections();
        quizContainer.classList.remove('hidden');
        renderQuizLayout();
        
        // Update page title to show search context
        pageTitle.textContent = `Search: "${query}" (${searchResults.length} results)`;
        
        // Highlight search terms
        setTimeout(() => {
            highlightSearchTerms(query);
        }, 100);
    } else {
        // Show no results message
        showSearchNoResults(query);
    }
}

function showSearchNoResults(query) {
    hideAllSections();
    quizContainer.innerHTML = `
        <div class="no-questions" style="text-align: center; padding: 80px 20px;">
            <div style="font-size: 64px; color: var(--text-tertiary); margin-bottom: 24px; opacity: 0.5;">
                <i class="fas fa-search"></i>
            </div>
            <h2 style="font-size: 28px; margin-bottom: 16px; color: var(--text-primary);">No Results Found</h2>
            <p style="color: var(--text-secondary); margin-bottom: 32px; max-width: 400px; margin-left: auto; margin-right: auto;">
                No questions match your search for "<strong style="color: var(--primary);">${query}</strong>". Try different keywords or browse categories.
            </p>
            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                <button class="quiz-btn" onclick="clearSearch()" style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 12px 24px; border-radius: 12px;">
                    <i class="fas fa-times"></i>
                    Clear Search
                </button>
                <button class="quiz-btn" onclick="toggleSidebar()" style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 12px 24px; border-radius: 12px;">
                    <i class="fas fa-folder-open"></i>
                    Browse Categories
                </button>
            </div>
        </div>
    `;
    quizContainer.classList.remove('hidden');
    pageTitle.textContent = `Search: "${query}" (0 results)`;
}

function clearSearch() {
    searchInput.value = '';
    document.body.classList.remove('search-blur-active');
    isSearchActive = false;
    showDashboard();
}

function highlightSearchTerms(query) {
    const questionTexts = document.querySelectorAll('.question-text');
    const optionTexts = document.querySelectorAll('.option-text');
    const categoryElements = document.querySelectorAll('.question-category');
    
    const highlightText = (element) => {
        const originalText = element.textContent;
        const regex = new RegExp(`(${query})`, 'gi');
        const highlighted = originalText.replace(regex, '<mark class="search-highlight">$1</mark>');
        element.innerHTML = highlighted;
    };
    
    questionTexts.forEach(highlightText);
    optionTexts.forEach(highlightText);
    categoryElements.forEach(highlightText);
}

function initializeKeyboardNavigation() {
    document.addEventListener('keydown', (e) => {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
        
        switch(e.key) {
            case 'ArrowDown':
            case 'ArrowUp':
                e.preventDefault();
                navigateOptions(e.key === 'ArrowDown' ? 1 : -1);
                break;
            case ' ':
            case 'Enter':
                e.preventDefault();
                if (document.activeElement.classList.contains('option')) {
                    document.activeElement.click();
                }
                break;
            case '1':
            case '2':
            case '3':
            case '4':
            case '5':
                e.preventDefault();
                const index = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option:not(.disabled)');
                if (options[index]) {
                    options[index].click();
                }
                break;
            case 'Escape':
                if (document.querySelector('.custom-quiz-modal')) {
                    document.querySelector('.custom-quiz-modal').remove();
                }
                break;
        }
    });
}

function navigateOptions(direction) {
    const options = document.querySelectorAll('.option:not(.disabled)');
    const currentIndex = Array.from(options).findIndex(opt => opt === document.activeElement);
    let nextIndex = currentIndex + direction;
    
    if (nextIndex < 0) nextIndex = options.length - 1;
    if (nextIndex >= options.length) nextIndex = 0;
    
    options[nextIndex].focus();
}

function enhanceAccessibility() {
    document.addEventListener('click', (e) => {
        if (e.target.classList.contains('option')) {
            const options = e.target.parentElement.querySelectorAll('.option');
            options.forEach((opt, index) => {
                opt.setAttribute('aria-checked', opt.classList.contains('selected') ? 'true' : 'false');
                opt.setAttribute('role', 'radio');
                opt.setAttribute('tabindex', '0');
            });
        }
    });
}

function loadUserData() {
    const savedProgress = localStorage.getItem('mediQuizProgress');
    const savedStats = localStorage.getItem('mediQuizStats');
    const savedBookmarks = localStorage.getItem('mediQuizBookmarks');
    const savedCustomQuestions = localStorage.getItem('mediQuizCustomQuestions');
    
    if (savedProgress) {
        userProgress = JSON.parse(savedProgress);
    }
    if (savedStats) {
        userStats = JSON.parse(savedStats);
        const today = new Date().toDateString();
        const lastActive = new Date(userStats.lastActive).toDateString();
        if (lastActive !== today) {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            if (lastActive === yesterday.toDateString()) {
                userStats.streak++;
            } else {
                userStats.streak = 1;
            }
        }
    }
    if (savedBookmarks) {
        bookmarkedQuestions = new Set(JSON.parse(savedBookmarks));
    }
    if (savedCustomQuestions) {
        customQuestions = JSON.parse(savedCustomQuestions);
    }
    
    userStats.lastActive = new Date().toISOString();
    saveUserData();
}

function saveUserData() {
    localStorage.setItem('mediQuizProgress', JSON.stringify(userProgress));
    localStorage.setItem('mediQuizStats', JSON.stringify(userStats));
    localStorage.setItem('mediQuizBookmarks', JSON.stringify(Array.from(bookmarkedQuestions)));
    localStorage.setItem('mediQuizCustomQuestions', JSON.stringify(customQuestions));
}

function updateDashboardStats() {
    correctAnswersEl.textContent = userStats.correctAnswers;
    timeSpentEl.textContent = `${Math.floor(userStats.timeSpent / 60)}h ${userStats.timeSpent % 60}m`;
    masteryLevelEl.textContent = `${userStats.masteryLevel}%`;
    streakCountEl.textContent = userStats.streak;
}

function updateAnalytics() {
    const allQuestions = [...quizData, ...customQuestions];
    const weakAreas = Object.entries(userProgress)
        .filter(([_, data]) => data.attempts > 0 && (data.correct / data.attempts) < 0.6)
        .map(([id, _]) => allQuestions.find(q => q.id == id)?.category)
        .reduce((acc, category) => {
            acc[category] = (acc[category] || 0) + 1;
            return acc;
        }, {});
        
    weakAreasCountEl.textContent = Object.keys(weakAreas).length;
    
    const totalTime = userStats.timeSpent * 60;
    const avgTime = userStats.totalQuestions > 0 ? Math.round(totalTime / userStats.totalQuestions) : 0;
    avgTimePerQuestionEl.textContent = `${avgTime}s`;
    
    if (userStats.weeklyProgress.length > 1) {
        const latest = userStats.weeklyProgress[userStats.weeklyProgress.length - 1];
        const previous = userStats.weeklyProgress[userStats.weeklyProgress.length - 2];
        const improvement = ((latest - previous) / previous) * 100;
        improvementRateEl.textContent = `${Math.round(improvement)}%`;
    } else {
        improvementRateEl.textContent = "0%";
    }
}

function exportProgress() {
    const data = {
        progress: userProgress,
        stats: userStats,
        bookmarks: Array.from(bookmarkedQuestions),
        customQuestions: customQuestions,
        exportDate: new Date().toISOString(),
        analytics: generateStudyReport()
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `mediquiz-progress-${new Date().toISOString().split('T')[0]}.json`;
    a.click();
    URL.revokeObjectURL(url);
    
    showNotification('Progress data exported successfully!', 'success');
}

function createCustomQuiz(options) {
    let filteredQuestions = [...quizData, ...customQuestions];
    
    if (options.categories && options.categories.length > 0) {
        filteredQuestions = filteredQuestions.filter(q => options.categories.includes(q.category));
    }
    
    if (options.difficulty) {
        filteredQuestions = filteredQuestions.filter(q => q.difficulty.toLowerCase() === options.difficulty);
    }
    
    if (options.bookmarkedOnly) {
        filteredQuestions = filteredQuestions.filter(q => bookmarkedQuestions.has(q.id));
    }
    
    if (options.count && options.count > 0) {
        filteredQuestions = shuffleArray(filteredQuestions).slice(0, options.count);
    }
    
    questions = filteredQuestions;
    currentQuestionIndex = 0;
    userAnswers = new Array(questions.length);
    isAnswerChecked = false;
    examSubmitted = false;
    
    if (questions.length === 0) {
        showNoQuestionsMessage();
        return;
    }
    
    hideAllSections();
    renderQuizLayout();
    customQuizModal.classList.remove('active');
    showNotification(`Custom quiz created with ${questions.length} questions`, 'success');
}

function shuffleArray(array) {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
}

function generateStudyReport() {
    const allQuestions = [...quizData, ...customQuestions];
    const weakAreas = Object.entries(userProgress)
        .filter(([_, data]) => data.attempts > 0 && (data.correct / data.attempts) < 0.6)
        .map(([id, _]) => {
            const question = allQuestions.find(q => q.id == id);
            return {
                questionId: id,
                category: question?.category,
                difficulty: question?.difficulty,
                performance: userProgress[id].correct / userProgress[id].attempts
            };
        });
        
    const strongAreas = Object.entries(userProgress)
        .filter(([_, data]) => data.attempts > 0 && (data.correct / data.attempts) >= 0.8)
        .map(([id, _]) => {
            const question = allQuestions.find(q => q.id == id);
            return {
                questionId: id,
                category: question?.category,
                difficulty: question?.difficulty,
                performance: userProgress[id].correct / userProgress[id].attempts
            };
        });
        
    return {
        weakAreas,
        strongAreas,
        totalMastered: Object.values(userProgress).filter(p => p.correct >= 3).length,
        totalQuestions: allQuestions.length,
        masteryPercentage: calculateMasteryLevel(),
        generatedAt: new Date().toISOString()
    };
}

function showNotification(message, type = 'info') {
    // Remove existing notifications
    document.querySelectorAll('.notification').forEach(n => n.remove());
    
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.style.cssText = `
        position: fixed;
        top: 30px;
        right: 30px;
        padding: 20px 28px;
        background: ${type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--error)' : 'var(--primary)'};
        color: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        z-index: 10000;
        transform: translateX(100%);
        transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        backdrop-filter: blur(30px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        font-weight: 600;
        max-width: 400px;
        line-height: 1.5;
    `;
    notification.innerHTML = `
        <div style="display: flex; align-items: center; gap: 12px;">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'}" style="font-size: 20px;"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.transform = 'translateX(0)';
    }, 100);
    
    setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
            if (document.body.contains(notification)) {
                document.body.removeChild(notification);
            }
        }, 400);
    }, 4000);
}

function initializeCategories() {
    const allQuestions = [...quizData, ...customQuestions];
    const categories = [...new Set(allQuestions.map(q => q.category))];
    const categoryIcons = {
        "Anatomy Fundamentals": "fas fa-brain",
        "Neuroanatomy": "fas fa-brain",
        "Gastrointestinal System": "fas fa-stomach",
        "Cardiovascular System": "fas fa-heart",
        "Custom Anatomy": "fas fa-user-md",
        "Custom Physiology": "fas fa-heartbeat",
        "Custom Pathology": "fas fa-virus",
        "Custom Pharmacology": "fas fa-pills",
        "General Medicine": "fas fa-stethoscope"
    };
    
    const categoryColors = {
        "Anatomy Fundamentals": "#6366f1",
        "Neuroanatomy": "#06b6d4",
        "Gastrointestinal System": "#10b981",
        "Cardiovascular System": "#ef4444",
        "Custom Anatomy": "#8b5cf6",
        "Custom Physiology": "#f59e0b",
        "Custom Pathology": "#ec4899",
        "Custom Pharmacology": "#84cc16",
        "General Medicine": "#64748b"
    };

    categoriesGrid.innerHTML = '';
    categories.forEach(category => {
        const categoryQuestions = allQuestions.filter(q => q.category === category);
        const mastered = categoryQuestions.filter(q =>
            userProgress[q.id] && userProgress[q.id].correct >= 3
        ).length;
        const progress = categoryQuestions.length > 0 ?
            Math.round((mastered / categoryQuestions.length) * 100) : 0;
            
        const categoryCard = document.createElement('div');
        categoryCard.className = 'category-card active glass-effect';
        categoryCard.dataset.category = category;
        categoryCard.style.borderLeft = `4px solid ${categoryColors[category] || '#6366f1'}`;
        categoryCard.innerHTML = `
            <div class="category-header">
                <div class="category-icon" style="background: ${categoryColors[category] || '#6366f1'}20; color: ${categoryColors[category] || '#6366f1'}">
                    <i class="${categoryIcons[category] || 'fas fa-question'}"></i>
                </div>
                <div class="category-name">${category}</div>
                ${category.includes('Custom') ? '<div style="font-size: 10px; color: var(--primary); background: var(--primary-light); padding: 2px 6px; border-radius: 8px;">Custom</div>' : ''}
            </div>
            <div class="category-stats">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${progress}%; background: ${categoryColors[category] || '#6366f1'}"></div>
                </div>
                <div class="progress-text">${progress}%</div>
            </div>
            <div style="font-size: 11px; color: var(--text-tertiary); margin-top: 8px;">
                ${categoryQuestions.length} question${categoryQuestions.length !== 1 ? 's' : ''}
                ${categoryQuestions.filter(q => q.custom).length > 0 ? ` Â· ${categoryQuestions.filter(q => q.custom).length} custom` : ''}
            </div>
        `;
        
        if (categoryQuestions.length > 1) {
            const dropdown = document.createElement('div');
            dropdown.className = 'modern-dropdown';
            dropdown.innerHTML = `
                <select onchange="jumpToQuestion(this.value)">
                    <option value="">Jump to Question...</option>
                    ${categoryQuestions.sort((a, b) => a.id - b.id).map(q => 
                        `<option value="question-${q.id}">Q${q.id}: ${q.question.substring(0, 50)}${q.question.length > 50 ? '...' : ''}${q.custom ? ' â˜…' : ''}</option>`
                    ).join('')}
                </select>
            `;
            categoryCard.appendChild(dropdown);
        }
        
        categoryCard.addEventListener('click', (e) => {
            if (!e.target.closest('.modern-dropdown') && !e.target.closest('select')) {
                toggleCategory(categoryCard);
                const firstQ = categoryQuestions.sort((a, b) => a.id - b.id)[0];
                if (firstQ) {
                    jumpToQuestion(`question-${firstQ.id}`);
                }
            }
        });
        
        categoriesGrid.appendChild(categoryCard);
    });
    
    selectedCategories = [...categories];
}

function toggleCategory(categoryCard) {
    const category = categoryCard.dataset.category;
    if (categoryCard.classList.contains('active')) {
        categoryCard.classList.remove('active');
        selectedCategories = selectedCategories.filter(c => c !== category);
    } else {
        categoryCard.classList.add('active');
        selectedCategories.push(category);
    }
    startQuiz();
    closeSidebar();
}

function startQuiz() {
    if (currentPage !== 'dashboard') return;
    
    quizContainer.style.opacity = '0';
    setTimeout(() => {
        const allQuestions = [...quizData, ...customQuestions];
        questions = selectedCategories.length > 0 ? 
            allQuestions.filter(q => selectedCategories.includes(q.category)) : 
            allQuestions;
            
        if (questions.length === 0) {
            showNoQuestionsMessage();
            return;
        }
        if (currentMode === 'learn' && incorrectQuestions.length > 0) {
            questions = allQuestions.filter(q => incorrectQuestions.includes(q.id));
        }
        if (questions.length === 0) {
            showNoQuestionsMessage();
            return;
        }
        questions.sort((a, b) => a.id - b.id);
        currentQuestionIndex = 0;
        score = 0;
        userAnswers = new Array(questions.length);
        isAnswerChecked = false;
        examSubmitted = false;
        quizContainer.classList.remove('hidden');
        resultsScreen.classList.add('hidden');
        questionTimers = new Array(questions.length).fill(0);
        if (currentMode === 'exam') {
            isCountdown = true;
            remainingTime = 120 * questions.length;
        } else {
            isCountdown = false;
        }
        startTimer();
        renderQuizLayout();
        quizContainer.style.opacity = '1';
    }, 300);
}

function showNoQuestionsMessage() {
    let message = '';
    if (isSearchActive) {
        message = 'No questions match your search criteria. Try different keywords.';
    } else if (selectedCategories.length === 0) {
        message = 'No categories selected. Please select categories from the sidebar.';
    } else {
        message = 'No questions available for the selected categories.';
    }
    
    quizContainer.innerHTML = `
        <div class="no-questions" style="text-align: center; padding: 80px 20px;">
            <div style="font-size: 64px; color: var(--text-tertiary); margin-bottom: 24px; opacity: 0.5;">
                <i class="fas fa-inbox"></i>
            </div>
            <h2 style="font-size: 28px; margin-bottom: 16px; color: var(--text-primary);">No Questions Available</h2>
            <p style="color: var(--text-secondary); margin-bottom: 32px; max-width: 400px; margin-left: auto; margin-right: auto;">
                ${message}
            </p>
            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                <button class="quiz-btn" onclick="toggleSidebar()" style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 12px 24px; border-radius: 12px;">
                    <i class="fas fa-folder-open"></i>
                    Select Categories
                </button>
                <button class="quiz-btn" onclick="showCustomQuestionCreator()" style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 12px 24px; border-radius: 12px;">
                    <i class="fas fa-plus"></i>
                    Create Question
                </button>
                ${isSearchActive ? `
                    <button class="quiz-btn" onclick="clearSearch()" style="background: linear-gradient(135deg, var(--secondary), #4b5563); color: white; padding: 12px 24px; border-radius: 12px;">
                        <i class="fas fa-times"></i>
                        Clear Search
                    </button>
                ` : ''}
            </div>
        </div>
    `;
    resultsScreen.classList.add('hidden');
    stopTimer();
    quizContainer.style.opacity = '1';
}

function startTimer() {
    if (timerInterval) clearInterval(timerInterval);
    startTime = new Date();
    timerInterval = setInterval(() => {
        if (isCountdown) {
            remainingTime--;
            if (remainingTime <= 0) {
                remainingTime = 0;
                clearInterval(timerInterval);
                if (currentMode === 'exam' && !examSubmitted) {
                    showNotification('Time up! Submitting exam.', 'error');
                    submitExam();
                }
            }
            updateTimerDisplay(formatTime(remainingTime), 'timerDisplay', true);
        } else {
            questionTimers[currentQuestionIndex]++;
            updateTimerDisplay(formatTime(questionTimers[currentQuestionIndex]), 'timerDisplay', false);
        }
    }, 1000);
}

function formatTime(seconds) {
    const min = Math.floor(seconds / 60).toString().padStart(2, '0');
    const sec = (seconds % 60).toString().padStart(2, '0');
    return `${min}:${sec}`;
}

function updateTimerDisplay(time, id, isCountdown = false) {
    const el = document.getElementById(id);
    if (el) {
        el.textContent = `Time: ${time}`;
        if (isCountdown) {
            el.classList.remove('timer-warning', 'timer-error');
            if (remainingTime <= 30) {
                el.classList.add('timer-error');
            } else if (remainingTime <= 60) {
                el.classList.add('timer-warning');
            }
        }
    }
}

function stopTimer() {
    if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
        if (startTime) {
            const endTime = new Date();
            const timeSpent = Math.floor((endTime - startTime) / 1000 / 60);
            userStats.timeSpent += timeSpent;
            userStats.lastActive = new Date().toISOString();
            saveUserData();
            updateDashboardStats();
        }
    }
}

function renderQuizLayout() {
    if (questions.length === 0) {
        showNoQuestionsMessage();
        return;
    }
    
    if (currentMode === 'exam') {
        renderExamLayout();
    } else {
        renderSingleQuestionLayout();
    }
}

function renderExamLayout() {
    const isImmediateMode = examCheckMode === 'immediate';
    quizContainer.innerHTML = `
        <div class="exam-header" style="margin-bottom: 24px; padding: 20px; background: var(--surface); border-radius: var(--radius); border: 1px solid var(--border);">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                <div>
                    <h3 style="font-size: 18px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">
                        Exam Mode: ${questions.length} Questions
                    </h3>
                    <p style="color: var(--text-secondary); font-size: 14px;">
                        ${isImmediateMode ?
                          'Immediate Check - See explanations as you answer' :
                          'All-in-One Check - Check all answers at the end'}
                    </p>
                </div>
                <div class="exam-mode-toggle" style="display: flex; gap: 8px; background: var(--glass); padding: 4px; border-radius: var(--radius);">
                    <button class="mode-toggle-btn ${isImmediateMode ? 'active' : ''}" data-mode="immediate" style="padding: 8px 16px; border: none; border-radius: 6px; background: ${isImmediateMode ? 'var(--primary)' : 'transparent'}; color: ${isImmediateMode ? 'white' : 'var(--text-secondary)'}; cursor: pointer; font-size: 12px; font-weight: 500;" aria-label="Immediate Check Mode">
                        Immediate Check
                    </button>
                    <button class="mode-toggle-btn ${!isImmediateMode ? 'active' : ''}" data-mode="all-at-once" style="padding: 8px 16px; border: none; border-radius: 6px; background: ${!isImmediateMode ? 'var(--primary)' : 'transparent'}; color: ${!isImmediateMode ? 'white' : 'var(--text-secondary)'}; cursor: pointer; font-size: 12px; font-weight: 500;" aria-label="All-at-Once Check Mode">
                        Check All
                    </button>
                </div>
            </div>
            <div class="progress-info" style="display: flex; align-items: center; gap: 16px;">
                <span style="font-size: 14px; color: var(--text-secondary);" id="answeredCount">0/${questions.length} answered</span>
                <div class="progress-bar" style="flex: 1; height: 6px;">
                    <div class="progress-fill" id="examProgressFill" style="width: 0%"></div>
                </div>
                <span id="timerDisplay" style="font-size: 14px; color: var(--text-secondary);">Time: ${formatTime(remainingTime)}</span>
                ${examSubmitted ? `<span style="color: var(--success); font-weight: 600; font-size: 14px;">Submitted!</span>` : ''}
            </div>
        </div>
        <div class="exam-mode-layout">
            ${questions.map((question, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer === question.answer;
                const showExplanationButton = examSubmitted || (isImmediateMode && userAnswer !== undefined);
                return `
                    <div class="question-card fade-in" data-question-index="${index}" id="question-${question.id}">
                        <div class="question-header">
                            <div class="question-meta">
                                <div class="question-number">Q${question.id}</div>
                                <div class="question-category">${question.category}</div>
                                <div class="question-difficulty" style="padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; background: ${getDifficultyColor(question.difficulty)}; color: white;">
                                    ${question.difficulty}
                                </div>
                                ${userAnswer !== undefined ? `
                                    <div class="answer-status ${isCorrect ? 'correct' : 'incorrect'}" style="padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; background: ${isCorrect ? 'var(--success)' : 'var(--error)'}; color: white;">
                                        ${isCorrect ? 'Correct' : 'Incorrect'}
                                    </div>
                                ` : ''}
                            </div>
                            <div class="question-actions">
                                <button class="action-btn bookmark-btn" data-question-id="${question.id}" aria-label="Bookmark Question">
                                    <i class="${bookmarkedQuestions.has(question.id) ? 'fas' : 'far'} fa-bookmark"></i>
                                </button>
                            </div>
                        </div>
                        <div class="question-text">${question.question}</div>
                        <div class="options-grid">
                            ${question.options.map((option, optIndex) => {
                                const isSelected = userAnswer === optIndex;
                                const isCorrectOption = optIndex === question.answer;
                                let optionClass = 'option';
                                if (userAnswer !== undefined) {
                                    if (isCorrectOption) {
                                        optionClass += ' correct';
                                    } else if (isSelected && !isCorrectOption) {
                                        optionClass += ' incorrect';
                                    }
                                    optionClass += ' disabled';
                                } else if (isSelected) {
                                    optionClass += ' selected';
                                }
                                return `
                                    <div class="${optionClass}" data-option-index="${optIndex}" role="button" aria-label="Option ${String.fromCharCode(65 + optIndex)}">
                                        <div class="option-letter">${String.fromCharCode(65 + optIndex)}</div>
                                        <div class="option-text">${option}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        ${showExplanationButton ? `
                            <div class="explanation-section">
                                <details open>
                                    <summary><i class="fas fa-info-circle"></i> Correct Answer</summary>
                                    <div class="explanation-content correct-answer">
                                        <strong>Answer: ${String.fromCharCode(65 + question.answer)}. ${question.correctAnswer}</strong>
                                    </div>
                                </details>
                                ${userAnswer !== undefined && userAnswer !== question.answer ? `
                                    <details>
                                        <summary><i class="fas fa-exclamation-circle"></i> Why Not Your Answer?</summary>
                                        <div class="explanation-content why-not-section">
                                            <strong>Why not ${String.fromCharCode(65 + userAnswer)}?</strong>
                                            <p>${question.whyNotOtherOptions[String.fromCharCode(97 + userAnswer)]}</p>
                                        </div>
                                    </details>
                                ` : ''}
                                <details>
                                    <summary><i class="fas fa-book"></i> Detailed Explanation</summary>
                                    <div class="explanation-content">${question.explanation}</div>
                                </details>
                                <details>
                                    <summary><i class="fas fa-link"></i> Related Questions</summary>
                                    <div class="explanation-content related-questions">
                                        <div class="related-questions-list">
                                            ${question.relatedQuestions.map(q => {
                                                const qId = q.match(/\d+/)[0];
                                                return `<span class="related-question-tag" onclick="jumpToQuestion('question-${qId}')" role="button" aria-label="Jump to Question ${qId}">Q${qId}</span>`;
                                            }).join('')}
                                        </div>
                                    </div>
                                </details>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('')}
            <div class="quiz-controls">
                <div style="display: flex; gap: 12px;">
                    ${examCheckMode === 'all-at-once' && !examSubmitted ? `
                        <button class="quiz-btn check-btn" id="checkAllBtn" ${userAnswers.filter(a => a !== undefined).length === 0 ? 'disabled' : ''} aria-label="Check All Answers">
                            <i class="fas fa-check-double"></i>
                            Check All Answers
                        </button>
                    ` : ''}
                </div>
                <button class="quiz-btn submit-btn" id="examSubmitBtn" ${examSubmitted ? 'disabled' : ''} aria-label="Submit Exam">
                    <i class="fas fa-paper-plane"></i>
                    ${examSubmitted ? 'Exam Submitted' : `Submit Exam (${questions.length} questions)`}
                </button>
            </div>
        </div>
    `;
    initializeExamModeEvents();
    updateExamSubmitButton();
}

function renderSingleQuestionLayout() {
    if (currentQuestionIndex >= questions.length) {
        showResults();
        return;
    }
    const question = questions[currentQuestionIndex];
    const userAnswer = userAnswers[currentQuestionIndex];
    const isCorrect = userAnswer === question.answer;
    quizContainer.innerHTML = `
        <div class="question-card fade-in" data-question-index="${currentQuestionIndex}">
            <div class="question-header">
                <div class="question-meta">
                    <div class="question-number">Q${question.id}</div>
                    <div class="question-category">${question.category}</div>
                    <div class="question-difficulty" style="background: ${getDifficultyColor(question.difficulty)};">
                        ${question.difficulty}
                    </div>
                    ${userAnswer !== undefined ? `
                        <div class="answer-status ${isCorrect ? 'correct' : 'incorrect'}" style="padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; background: ${isCorrect ? 'var(--success)' : 'var(--error)'}; color: white;">
                            ${isCorrect ? 'Correct' : 'Incorrect'}
                        </div>
                    ` : ''}
                </div>
                <div class="question-actions">
                    <button class="action-btn bookmark-btn" data-question-id="${question.id}" aria-label="Bookmark Question">
                        <i class="${bookmarkedQuestions.has(question.id) ? 'fas' : 'far'} fa-bookmark"></i>
                    </button>
                </div>
            </div>
            <div class="question-text">${question.question}</div>
            <div class="options-grid">
                ${question.options.map((option, index) => {
                    const isSelected = userAnswer === index;
                    const isCorrectOption = index === question.answer;
                    let optionClass = 'option';
                    if (isAnswerChecked) {
                        if (isCorrectOption) {
                            optionClass += ' correct';
                        } else if (isSelected && !isCorrectOption) {
                            optionClass += ' incorrect';
                        }
                        optionClass += ' disabled';
                    } else if (isSelected) {
                        optionClass += ' selected';
                    }
                    return `
                        <div class="${optionClass}" data-option-index="${index}" role="button" aria-label="Option ${String.fromCharCode(65 + index)}">
                            <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                            <div class="option-text">${option}</div>
                        </div>
                    `;
                }).join('')}
            </div>
            ${isAnswerChecked ? `
                <div class="explanation-section">
                    <details open>
                        <summary><i class="fas fa-info-circle"></i> Correct Answer</summary>
                        <div class="explanation-content correct-answer">
                            <strong>Answer: ${String.fromCharCode(65 + question.answer)}. ${question.correctAnswer}</strong>
                        </div>
                    </details>
                    ${userAnswer !== undefined && userAnswer !== question.answer ? `
                        <details>
                            <summary><i class="fas fa-exclamation-circle"></i> Why Not Your Answer?</summary>
                            <div class="explanation-content why-not-section">
                                <strong>Why not ${String.fromCharCode(65 + userAnswer)}?</strong>
                                <p>${question.whyNotOtherOptions[String.fromCharCode(97 + userAnswer)]}</p>
                            </div>
                        </details>
                    ` : ''}
                    <details>
                        <summary><i class="fas fa-book"></i> Detailed Explanation</summary>
                        <div class="explanation-content">${question.explanation}</div>
                    </details>
                    <details>
                        <summary><i class="fas fa-link"></i> Related Questions</summary>
                        <div class="explanation-content related-questions">
                            <div class="related-questions-list">
                                ${question.relatedQuestions.map(q => {
                                    const qId = q.match(/\d+/)[0];
                                    return `<span class="related-question-tag" onclick="jumpToQuestion('question-${qId}')" role="button" aria-label="Jump to Question ${qId}">Q${qId}</span>`;
                                }).join('')}
                            </div>
                        </div>
                    </details>
                </div>
            ` : ''}
            <div class="quiz-controls">
                <div style="display: flex; gap: 12px;">
                    <button class="quiz-btn check-btn" id="checkAnswerBtn" ${userAnswer === undefined ? 'disabled' : ''} aria-label="Check Answer">
                        <i class="fas fa-check"></i>
                        Check Answer
                    </button>
                    ${currentMode === 'learn' && incorrectQuestions.length > 0 ? `
                        <button class="quiz-btn" id="incorrectOnlyBtn" aria-label="Show Incorrect Only">
                            <i class="fas fa-filter"></i>
                            Incorrect Only
                        </button>
                    ` : ''}
                </div>
                <button class="quiz-btn next-btn" id="nextQuestionBtn" ${!isAnswerChecked ? 'disabled' : ''} aria-label="Next Question">
                    <i class="fas fa-arrow-right"></i>
                    ${currentQuestionIndex < questions.length - 1 ? 'Next Question' : 'Finish'}
                </button>
            </div>
        </div>
    `;
    initializeQuizEvents();
    updateTimerDisplay(formatTime(isCountdown ? remainingTime : questionTimers[currentQuestionIndex]), 'timerDisplay', isCountdown);
}

function initializeQuizEvents() {
    const checkAnswerBtn = document.getElementById('checkAnswerBtn');
    const nextQuestionBtn = document.getElementById('nextQuestionBtn');
    const incorrectOnlyBtn = document.getElementById('incorrectOnlyBtn');
    const bookmarkBtn = document.querySelector('.bookmark-btn');
    const options = document.querySelectorAll('.option:not(.disabled)');
    
    options.forEach(option => {
        option.addEventListener('click', () => {
            if (!isAnswerChecked) {
                options.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                userAnswers[currentQuestionIndex] = parseInt(option.dataset.optionIndex);
                if (checkAnswerBtn) checkAnswerBtn.disabled = false;
                updateExamSubmitButton();
            }
        });
    });
    
    if (checkAnswerBtn) {
        checkAnswerBtn.addEventListener('click', () => {
            checkAnswer();
            renderQuizLayout();
        });
    }
    
    if (nextQuestionBtn) {
        nextQuestionBtn.addEventListener('click', () => {
            currentQuestionIndex++;
            isAnswerChecked = false;
            renderQuizLayout();
        });
    }
    
    if (incorrectOnlyBtn) {
        incorrectOnlyBtn.addEventListener('click', () => {
            questions = quizData.filter(q => incorrectQuestions.includes(q.id));
            currentQuestionIndex = 0;
            userAnswers = new Array(questions.length);
            isAnswerChecked = false;
            renderQuizLayout();
        });
    }
    
    if (bookmarkBtn) {
        bookmarkBtn.addEventListener('click', () => {
            const questionId = parseInt(bookmarkBtn.dataset.questionId);
            toggleBookmark(questionId);
            bookmarkBtn.querySelector('i').className = bookmarkedQuestions.has(questionId) ? 'fas fa-bookmark' : 'far fa-bookmark';
        });
    }
}

function initializeExamModeEvents() {
    const options = document.querySelectorAll('.option:not(.disabled)');
    const checkAllBtn = document.getElementById('checkAllBtn');
    const submitBtn = document.getElementById('examSubmitBtn');
    const modeToggleButtons = document.querySelectorAll('.mode-toggle-btn');
    
    options.forEach(option => {
        option.addEventListener('click', () => {
            const questionIndex = parseInt(option.closest('.question-card').dataset.questionIndex);
            const prevSelected = option.closest('.options-grid').querySelector('.selected');
            if (prevSelected) prevSelected.classList.remove('selected');
            option.classList.add('selected');
            userAnswers[questionIndex] = parseInt(option.dataset.optionIndex);
            updateExamProgress();
            updateExamSubmitButton();
            if (examCheckMode === 'immediate') {
                checkAnswer(questionIndex);
                renderQuizLayout();
            }
        });
    });
    
    if (checkAllBtn) {
        checkAllBtn.addEventListener('click', () => {
            userAnswers.forEach((answer, index) => {
                if (answer !== undefined) {
                    checkAnswer(index);
                }
            });
            renderQuizLayout();
        });
    }
    
    if (submitBtn) {
        submitBtn.addEventListener('click', submitExam);
    }
    
    modeToggleButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            modeToggleButtons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            examCheckMode = btn.dataset.mode;
            renderQuizLayout();
        });
    });
    
    document.querySelectorAll('.bookmark-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const questionId = parseInt(btn.dataset.questionId);
            toggleBookmark(questionId);
            btn.querySelector('i').className = bookmarkedQuestions.has(questionId) ? 'fas fa-bookmark' : 'far fa-bookmark';
        });
    });
}

function updateExamProgress() {
    const answered = userAnswers.filter(a => a !== undefined).length;
    const progressPercent = (answered / questions.length) * 100;
    const answeredCount = document.getElementById('answeredCount');
    const progressFill = document.getElementById('examProgressFill');
    if (answeredCount) {
        answeredCount.textContent = `${answered}/${questions.length} answered`;
    }
    if (progressFill) {
        progressFill.style.width = `${progressPercent}%`;
    }
}

function updateExamSubmitButton() {
    const submitBtn = document.getElementById('examSubmitBtn');
    if (submitBtn) {
        const allAnswered = userAnswers.every(a => a !== undefined);
        submitBtn.disabled = !allAnswered || examSubmitted;
        submitBtn.innerHTML = examSubmitted ?
            '<i class="fas fa-paper-plane"></i> Exam Submitted' :
            `<i class="fas fa-paper-plane"></i> Submit Exam (${questions.length} questions)`;
    }
}

function checkAnswer(questionIndex = currentQuestionIndex) {
    const question = questions[questionIndex];
    const userAnswer = userAnswers[questionIndex];
    isAnswerChecked = true;
    if (userAnswer === question.answer) {
        score++;
        userStats.correctAnswers++;
        if (!userProgress[question.id]) userProgress[question.id] = { correct: 0, attempts: 0 };
        userProgress[question.id].correct++;
        userProgress[question.id].attempts++;
        incorrectQuestions = incorrectQuestions.filter(id => id !== question.id);
    } else {
        if (!incorrectQuestions.includes(question.id)) {
            incorrectQuestions.push(question.id);
        }
        if (!userProgress[question.id]) userProgress[question.id] = { correct: 0, attempts: 0 };
        userProgress[question.id].attempts++;
    }
    userStats.totalQuestions++;
    userStats.masteryLevel = calculateMasteryLevel();
    saveUserData();
    updateDashboardStats();
}

function submitExam() {
    examSubmitted = true;
    if (examCheckMode === 'all-at-once') {
        userAnswers.forEach((answer, index) => {
            if (answer !== undefined) {
                checkAnswer(index);
            }
        });
    }
    stopTimer();
    showResults();
}

function calculateMasteryLevel() {
    const masteredQuestions = Object.values(userProgress).filter(p => p.correct >= 3).length;
    return quizData.length > 0 ? Math.round((masteredQuestions / quizData.length) * 100) : 0;
}

function showResults() {
    stopTimer();
    quizContainer.classList.add('hidden');
    resultsScreen.classList.remove('hidden');
    const percentage = questions.length > 0 ? Math.round((score / questions.length) * 100) : 0;
    
    let restartText = 'Restart Quiz';
    if (currentPage === 'bookmarks') {
        restartText = 'Practice Again';
    }
    
    resultsScreen.innerHTML = `
        <div class="results-card fade-in">
            <div class="results-header">
                <h2 class="results-title">${currentMode.charAt(0).toUpperCase() + currentMode.slice(1)} Results</h2>
                <p class="score-text">You completed ${questions.length} question${questions.length !== 1 ? 's' : ''}</p>
            </div>
            <div class="score-display">${percentage}%</div>
            <div class="score-text">Score: ${score} out of ${questions.length} correct</div>
            <div class="results-details">
                ${questions.map((q, index) => {
                    const isCorrect = userAnswers[index] === q.answer;
                    return `
                        <div class="result-item">
                            <div class="result-question">Q${q.id}: ${q.question}</div>
                            <div class="result-status ${isCorrect ? 'result-correct' : 'result-incorrect'}">
                                ${isCorrect ? 'Correct' : 'Incorrect'}
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                <button class="restart-btn" id="restartQuiz" aria-label="Restart Quiz" style="margin: 0;">
                    <i class="fas fa-redo"></i>
                    ${restartText}
                </button>
                ${currentPage === 'bookmarks' ? `
                    <button class="quiz-btn" onclick="showBookmarks()" style="background: linear-gradient(135deg, var(--secondary), #4b5563); color: white; padding: 16px 24px; border-radius: var(--radius);">
                        <i class="fas fa-bookmark"></i>
                        Back to Bookmarks
                    </button>
                ` : ''}
            </div>
        </div>
    `;
    
    document.getElementById('restartQuiz').addEventListener('click', () => {
        if (currentPage === 'bookmarks') {
            startBookmarksQuiz();
        } else {
            startQuiz();
        }
    });
}

function toggleBookmark(questionId) {
    if (bookmarkedQuestions.has(questionId)) {
        bookmarkedQuestions.delete(questionId);
        showNotification('Question removed from bookmarks', 'info');
    } else {
        bookmarkedQuestions.add(questionId);
        showNotification('Question bookmarked', 'success');
    }
    saveUserData();
    
    // If we're on the bookmarks page, refresh it
    if (currentPage === 'bookmarks') {
        showBookmarks();
    }
}


function getDifficultyColor(difficulty) {
    switch (difficulty.toLowerCase()) {
        case 'easy': return '#10b981';
        case 'medium': return '#f59e0b';
        case 'hard': return '#ef4444';
        default: return '#64748b';
    }
}

function jumpToQuestion(questionId) {
    const questionIndex = questions.findIndex(q => `question-${q.id}` === questionId);
    if (questionIndex !== -1) {
        if (currentMode === 'exam') {
            const element = document.getElementById(questionId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        } else {
            currentQuestionIndex = questionIndex;
            isAnswerChecked = false;
            renderQuizLayout();
        }
    } else {
        // If question not in current quiz, start a new quiz with that question's category
        const question = quizData.find(q => `question-${q.id}` === questionId) || customQuestions.find(q => `question-${q.id}` === questionId);
        if (question) {
            selectedCategories = [question.category];
            startQuiz();
            setTimeout(() => {
                const element = document.getElementById(questionId);
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 500);
        }
    }
}

// Initialize the application
init();
    </script>
</body>
</html>